---
phase: 21-dashboard-hub-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/stores/sidebar-store.ts
  - src/app/admin/layout.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Sidebar collapse state persists across browser refreshes"
    - "Admin pages share consistent layout with sidebar and content area"
    - "Sidebar default state is expanded for new users"
  artifacts:
    - path: "src/lib/stores/sidebar-store.ts"
      provides: "Sidebar state management with localStorage persistence"
      exports: ["useSidebarStore"]
    - path: "src/app/admin/layout.tsx"
      provides: "Admin layout wrapper with sidebar + content structure"
      min_lines: 30
  key_links:
    - from: "src/app/admin/layout.tsx"
      to: "src/lib/stores/sidebar-store.ts"
      via: "imports useSidebarStore"
      pattern: "useSidebarStore"
---

<objective>
Create the foundation for the collapsible sidebar: a zustand store with localStorage persistence and the admin layout structure.

Purpose: Establishes the state management and layout foundation that all subsequent sidebar and navigation components will build upon. This is the prerequisite for sidebar animations and navigation items.

Output: Working sidebar state store persisting to localStorage, admin layout with flex structure ready for sidebar component.
</objective>

<execution_context>
@/home/memehalis/.claude/get-shit-done/workflows/execute-plan.md
@/home/memehalis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-dashboard-hub-navigation/21-CONTEXT.md
@.planning/phases/21-dashboard-hub-navigation/21-RESEARCH.md
@.planning/phases/20-design-system-foundation/DESIGN-TOKENS.md
@src/lib/stores/form-builder-store.ts
@src/app/admin/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sidebar store with localStorage persistence</name>
  <files>src/lib/stores/sidebar-store.ts</files>
  <action>
Create a zustand store for sidebar state management following the pattern established in form-builder-store.ts.

**Store interface:**
```typescript
interface SidebarState {
  isCollapsed: boolean;
  isHovering: boolean;
  setCollapsed: (collapsed: boolean) => void;
  setHovering: (hovering: boolean) => void;
  toggleCollapsed: () => void;
}
```

**Implementation requirements:**
1. Storage key: `frontierios-sidebar-state`
2. Default state: `isCollapsed: false` (expanded for new users per CONTEXT.md)
3. `setCollapsed` must persist to localStorage on every call
4. Handle SSR gracefully - don't read localStorage during module initialization
5. Use lazy initialization pattern for hydration safety
6. Wrap localStorage access in try-catch for storage quota errors

**Key patterns from research:**
- Use `typeof window === 'undefined'` check before localStorage access
- Initialize from localStorage only on client side
- Persist only `isCollapsed` (not `isHovering` which is transient)
  </action>
  <verify>
```bash
# File exists and exports useSidebarStore
grep -q "export const useSidebarStore" src/lib/stores/sidebar-store.ts && echo "Store exported correctly"
# Check localStorage key is defined
grep -q "frontierios-sidebar-state" src/lib/stores/sidebar-store.ts && echo "Storage key correct"
```
  </verify>
  <done>
- Store exports `useSidebarStore` hook
- Store has `isCollapsed`, `isHovering`, `setCollapsed`, `setHovering`, `toggleCollapsed`
- Default `isCollapsed` is `false`
- localStorage persistence works (manual test in browser DevTools)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create admin layout with sidebar structure</name>
  <files>src/app/admin/layout.tsx</files>
  <action>
Create the admin layout that will wrap all `/admin/*` pages. This layout provides the structure for the sidebar and main content area.

**Layout structure:**
```tsx
// Outer container with flex
<div className="flex min-h-screen bg-background">
  {/* Sidebar placeholder - will be replaced with actual Sidebar component */}
  <aside className="hidden lg:block">
    {/* Sidebar goes here in Plan 02 */}
  </aside>

  {/* Main content area */}
  <main className="flex-1 overflow-auto">
    {children}
  </main>
</div>
```

**Requirements:**
1. Use "use client" since we'll need zustand and interactivity
2. Import the sidebar store (preparation for Plan 02)
3. Set up the flex container for sidebar + content
4. Mobile-first: sidebar hidden below `lg:` breakpoint (1024px)
5. Preserve ThemeProvider wrapping from existing setup
6. Move common auth check logic here OR keep in individual pages (prefer keeping in pages for now - defense in depth)

**Note:** The actual Sidebar component will be created in Plan 02. This plan establishes the layout shell.
  </action>
  <verify>
```bash
# File exists
test -f src/app/admin/layout.tsx && echo "Layout exists"
# Uses client directive
grep -q '"use client"' src/app/admin/layout.tsx && echo "Client component"
# Has flex structure
grep -q "flex min-h-screen" src/app/admin/layout.tsx && echo "Flex layout present"
```
  </verify>
  <done>
- Admin layout file exists at src/app/admin/layout.tsx
- Layout wraps children with flex container
- Sidebar area is defined (placeholder for now)
- Main content area takes remaining space with flex-1
- npm run build succeeds without errors
  </done>
</task>

</tasks>

<verification>
```bash
# TypeScript compiles without errors
npm run build 2>&1 | tail -20

# Admin pages still render (layout doesn't break them)
# Manual: Visit /admin/login, should still work
```
</verification>

<success_criteria>
1. `src/lib/stores/sidebar-store.ts` exports `useSidebarStore`
2. `src/app/admin/layout.tsx` provides flex layout structure
3. Sidebar state defaults to expanded (`isCollapsed: false`)
4. Application builds without TypeScript errors
5. Existing admin functionality unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/21-dashboard-hub-navigation/21-01-SUMMARY.md`
</output>
