---
phase: 27-form-generation-preview
plan: 02
type: execute
wave: 2
depends_on: [27-01]
files_modified:
  - src/components/ai-wizard/FormPreviewPanel.tsx
  - src/components/ai-wizard/PreviewStepContent.tsx
autonomous: true

must_haves:
  truths:
    - "Preview panel renders all supported field types (8 renderers for 10 type values)"
    - "User can navigate between form steps in preview"
    - "Preview matches how form will appear in public /apply/[slug]"
    - "Accept, Regenerate, and Modify Prompt actions are available"
  artifacts:
    - path: "src/components/ai-wizard/FormPreviewPanel.tsx"
      provides: "Preview panel for AI-generated form schema"
      min_lines: 100
    - path: "src/components/ai-wizard/PreviewStepContent.tsx"
      provides: "Single step renderer using DynamicField and FormProvider"
      min_lines: 40
  key_links:
    - from: "src/components/ai-wizard/PreviewStepContent.tsx"
      to: "src/components/dynamic-form/fields/index.tsx"
      via: "import DynamicField"
      pattern: "DynamicField"
    - from: "src/components/ai-wizard/PreviewStepContent.tsx"
      to: "react-hook-form"
      via: "FormProvider wrapper"
      pattern: "FormProvider"
---

<objective>
Create form preview panel that renders AI-generated schemas using existing DynamicField components

Purpose: Show accurate preview of generated form before creation, enabling iteration
Output: `FormPreviewPanel.tsx` displaying form steps with Accept/Regenerate/Modify actions
</objective>

<execution_context>
@/Users/memehalis/.claude/get-shit-done/workflows/execute-plan.md
@/Users/memehalis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-form-generation-preview/27-RESEARCH.md

# Key files for this plan
@src/components/dynamic-form/fields/index.tsx
@src/types/form-schema.ts
@src/lib/ai/schemas.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PreviewStepContent component</name>
  <files>src/components/ai-wizard/PreviewStepContent.tsx</files>
  <action>
Create `src/components/ai-wizard/PreviewStepContent.tsx`:

This component renders a single form step using DynamicField components wrapped in FormProvider.

```typescript
'use client';

import { useForm, FormProvider } from 'react-hook-form';
import { DynamicField } from '@/components/dynamic-form/fields';
import type { FormStep } from '@/types/form-schema';

interface PreviewStepContentProps {
  step: FormStep;
}

export function PreviewStepContent({ step }: PreviewStepContentProps) {
  // Create mock form methods - preview is read-only demonstration
  // Default values empty, mode onChange for immediate feedback
  const methods = useForm({
    defaultValues: {},
    mode: 'onChange',
  });

  return (
    <FormProvider {...methods}>
      <form onSubmit={(e) => e.preventDefault()} className="space-y-4">
        {step.fields.map((field) => (
          <DynamicField key={field.id} field={field} />
        ))}
      </form>
    </FormProvider>
  );
}
```

Key points:
- DynamicField requires FormProvider context (react-hook-form)
- Preview is demonstration-only, no actual form submission
- Prevent default on form submit to avoid page reload
- Each field renders identically to public form at /apply/[slug]
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/memehalis/ft-form && npx tsc --noEmit src/components/ai-wizard/PreviewStepContent.tsx 2>&1 | head -20
```
  </verify>
  <done>
- PreviewStepContent renders FormStep using DynamicField components
- FormProvider wrapper enables field functionality
- Form submit prevented (preview only)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FormPreviewPanel component</name>
  <files>src/components/ai-wizard/FormPreviewPanel.tsx</files>
  <action>
Create `src/components/ai-wizard/FormPreviewPanel.tsx`:

Interface:
```typescript
interface FormPreviewPanelProps {
  schema: AIFormSchemaOutput;
  onAccept: () => void;
  onRegenerate: () => void;
  onModifyPrompt: () => void;
}
```

Component structure:
1. **Header section:**
   - Title: "Form Preview"
   - Device mode toggle: Mobile (360px max-width) / Desktop (full width)
   - Use Smartphone and Monitor icons from lucide-react
   - Buttons styled as icon buttons with secondary/ghost variant based on selection

2. **Preview frame (Card):**
   - Shows current step title and description
   - Renders `PreviewStepContent` for current step
   - Step navigation at bottom if more than 1 step:
     - Back button (ChevronLeft) - disabled on first step
     - "Step X of Y" text
     - Next button (ChevronRight) - disabled on last step

3. **Stats summary:**
   - Small text showing: "{totalSteps} steps, {totalFields} fields"
   - Calculate totalFields by summing fields across all steps

4. **Action buttons (centered, with gap-3):**
   - "Modify Prompt" (outline variant) - calls onModifyPrompt
   - "Regenerate" (outline variant) - calls onRegenerate
   - "Use This Form" (primary/default variant) - calls onAccept

State:
- `currentStep: number` - starts at 0
- `deviceMode: 'mobile' | 'desktop'` - starts at 'mobile' (matches public form default)

Styling:
- Use Card, CardContent, CardHeader, CardTitle from shadcn/ui
- Mobile mode: `max-w-[360px] mx-auto` on the Card
- Desktop mode: no max-width constraint
- Step navigation: `border-t mt-6 pt-4` for visual separation

Import AIFormSchemaOutput from `@/lib/ai/schemas`.
  </action>
  <verify>
TypeScript compiles and lint passes:
```bash
cd /Users/memehalis/ft-form && npx tsc --noEmit src/components/ai-wizard/FormPreviewPanel.tsx && pnpm lint --quiet
```
  </verify>
  <done>
- FormPreviewPanel renders AIFormSchemaOutput schema
- Mobile/Desktop toggle switches max-width constraint
- Step navigation allows browsing all form steps
- Stats show step and field counts
- Three action buttons visible and wired to callbacks
  </done>
</task>

</tasks>

<verification>
- [ ] PreviewStepContent renders fields using DynamicField
- [ ] FormPreviewPanel displays complete form preview with step navigation
- [ ] Mobile/Desktop toggle works
- [ ] Action buttons present and functional (callbacks wired)
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>
Form preview panel ready for integration into wizard (Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/27-form-generation-preview/27-02-SUMMARY.md`
</output>
