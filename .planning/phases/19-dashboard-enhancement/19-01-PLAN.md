---
phase: 19-dashboard-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/submissions.ts
  - src/components/admin/DashboardStats.tsx
  - src/components/admin/AdminDashboard.tsx
autonomous: true

must_haves:
  truths:
    - "Admin sees total submission count on dashboard"
    - "Admin sees breakdown by status (New, Under Review, Accepted, Rejected)"
    - "Stats update in real-time when submissions change"
  artifacts:
    - path: "convex/submissions.ts"
      provides: "getStats query"
      exports: ["getStats"]
    - path: "src/components/admin/DashboardStats.tsx"
      provides: "Stats cards row component"
      min_lines: 40
    - path: "src/components/admin/AdminDashboard.tsx"
      provides: "Dashboard with stats above tabs"
      contains: "DashboardStats"
  key_links:
    - from: "src/components/admin/DashboardStats.tsx"
      to: "api.submissions.getStats"
      via: "useQuery hook"
      pattern: "useQuery.*api\\.submissions\\.getStats"
    - from: "src/components/admin/AdminDashboard.tsx"
      to: "DashboardStats"
      via: "component import and render"
      pattern: "import.*DashboardStats"
---

<objective>
Add stats cards to admin dashboard showing submission counts by status.

Purpose: Gives admins at-a-glance insight into submission volume and status distribution without scanning the table.
Output: DashboardStats component with 5 cards (Total, New, Under Review, Accepted, Rejected) rendered above AdminTabs.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-dashboard-enhancement/19-RESEARCH.md

@convex/submissions.ts
@convex/schema.ts
@src/components/admin/AdminDashboard.tsx
@src/components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create getStats query in Convex</name>
  <files>convex/submissions.ts</files>
  <action>
Add a `getStats` query that returns submission counts grouped by status.

Implementation:
1. Add new query export `getStats` with no args
2. Collect all submissions with `ctx.db.query("submissions").collect()`
3. Count totals: `{ total: N, new: N, under_review: N, accepted: N, rejected: N }`
4. Return the stats object

Note: Per research, `.collect()` is appropriate for small datasets (<1000 docs). No need for @convex-dev/aggregate.

```typescript
export const getStats = query({
  handler: async (ctx) => {
    const submissions = await ctx.db.query("submissions").collect();

    const stats = {
      total: submissions.length,
      new: 0,
      under_review: 0,
      accepted: 0,
      rejected: 0,
    };

    for (const sub of submissions) {
      stats[sub.status]++;
    }

    return stats;
  },
});
```
  </action>
  <verify>Run `npx convex dev` - no type errors. Query appears in Convex functions.</verify>
  <done>getStats query returns { total, new, under_review, accepted, rejected } counts.</done>
</task>

<task type="auto">
  <name>Task 2: Create DashboardStats component</name>
  <files>src/components/admin/DashboardStats.tsx</files>
  <action>
Create a new component that displays 5 stat cards in a responsive grid.

Implementation:
1. Create `DashboardStats.tsx` in `src/components/admin/`
2. Use `useQuery(api.submissions.getStats)` to fetch stats
3. Display 5 cards using shadcn/ui Card components:
   - Total Submissions (primary/accent color)
   - New (blue)
   - Under Review (yellow)
   - Accepted (green)
   - Rejected (red)
4. Grid layout: 5 columns on lg, 3 on md, 2 on sm, 1 on xs
5. Show loading skeleton while data loads
6. Use lucide-react icons: FileText (total), Clock (new), Eye (under review), CheckCircle (accepted), XCircle (rejected)

Card structure:
```tsx
<Card className="...">
  <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
    <CardTitle className="text-sm font-medium">{title}</CardTitle>
    {icon}
  </CardHeader>
  <CardContent>
    <div className="text-2xl font-bold">{count}</div>
  </CardContent>
</Card>
```

Color coding matches existing StatusBadge conventions (blue=new, yellow=under_review, green=accepted, red=rejected).
  </action>
  <verify>Component renders without errors. TypeScript compiles.</verify>
  <done>DashboardStats displays 5 cards with live submission counts from Convex.</done>
</task>

<task type="auto">
  <name>Task 3: Wire DashboardStats into AdminDashboard</name>
  <files>src/components/admin/AdminDashboard.tsx</files>
  <action>
Update AdminDashboard to render DashboardStats above the AdminTabs.

Implementation:
1. Import DashboardStats component
2. Add DashboardStats before AdminTabs inside the Suspense boundary
3. Add spacing between stats and tabs (mb-6 on stats container)
4. Keep existing Suspense/Skeleton fallback (stats will show own loading state)

Structure:
```tsx
<Suspense fallback={<Skeleton className="h-10 w-96" />}>
  <div className="space-y-6">
    <DashboardStats />
    <AdminTabs />
  </div>
</Suspense>
```
  </action>
  <verify>Visit /admin - stats cards appear above tabs. Changing submission status updates counts.</verify>
  <done>Admin dashboard shows stats cards at top, tabs below. Stats are reactive.</done>
</task>

</tasks>

<verification>
1. `npx convex dev` runs without errors
2. `npm run build` succeeds
3. Visit /admin - 5 stat cards visible above tabs
4. Cards show correct counts matching actual submissions
5. Change a submission status - card counts update in real-time
</verification>

<success_criteria>
- Stats cards display total and per-status counts
- Layout is responsive (5 cols -> 1 col as viewport shrinks)
- Counts update reactively when submission status changes
- Loading state shows skeleton before data loads
</success_criteria>

<output>
After completion, create `.planning/phases/19-dashboard-enhancement/19-01-SUMMARY.md`
</output>
