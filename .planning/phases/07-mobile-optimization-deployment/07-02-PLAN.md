---
phase: 07-mobile-optimization-deployment
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - vercel.json
autonomous: false

user_setup:
  - service: convex
    why: "Production deployment requires deploy key"
    env_vars:
      - name: CONVEX_DEPLOY_KEY
        source: "Convex Dashboard > Project Settings > Generate Production Deploy Key"
    dashboard_config:
      - task: "Generate production deploy key"
        location: "Convex Dashboard > Settings > Production Deploy Key"
  - service: vercel
    why: "Production environment variables"
    env_vars:
      - name: ADMIN_PASSWORD
        source: "Generate secure password (e.g., openssl rand -base64 24)"
      - name: SESSION_SECRET
        source: "Generate with: openssl rand -base64 32"
    dashboard_config:
      - task: "Add environment variables to Production environment"
        location: "Vercel Project > Settings > Environment Variables"

must_haves:
  truths:
    - "Application is deployed and accessible at production URL"
    - "Environment variables are configured for production"
    - "Convex functions deploy with Next.js build"
  artifacts:
    - path: "vercel.json"
      provides: "Vercel deployment configuration"
      contains: "convex deploy"
  key_links:
    - from: "vercel.json"
      to: "Convex backend"
      via: "npx convex deploy command"
      pattern: "convex deploy"
---

<objective>
Deploy application to Vercel with Convex backend integration

Purpose: Make the complete application available at a production URL with proper environment configuration for admin auth and Convex backend.

Output: vercel.json configuration file, deployed application at production URL.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-mobile-optimization-deployment/07-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Vercel Configuration</name>
  <files>
    vercel.json
  </files>
  <action>
    Create vercel.json at project root with Convex deployment integration:

    ```json
    {
      "$schema": "https://openapi.vercel.sh/vercel.json",
      "buildCommand": "npx convex deploy --cmd 'npm run build'"
    }
    ```

    This tells Vercel to:
    1. Run `npx convex deploy` which deploys Convex functions to production (when CONVEX_DEPLOY_KEY is set)
    2. Then run `npm run build` for the Next.js build
    3. The Convex CLI automatically sets NEXT_PUBLIC_CONVEX_URL to the production URL

    Note: No other configuration needed - Vercel auto-detects Next.js 16.
  </action>
  <verify>
    File exists at project root: ls -la vercel.json
    JSON is valid: cat vercel.json | jq .
    Contains buildCommand with convex deploy
  </verify>
  <done>
    vercel.json created with Convex deployment integration
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Configure production environment variables in external dashboards</action>
  <instructions>
    **Step 1: Generate Convex Production Deploy Key**
    1. Go to https://dashboard.convex.dev
    2. Select your project (ft-form)
    3. Go to Settings > Production Deploy Key
    4. Click "Generate Production Deploy Key"
    5. Copy the key (starts with "prod:")

    **Step 2: Generate Secrets**
    Run these commands locally to generate secrets:
    ```bash
    # Generate admin password
    openssl rand -base64 24
    # Copy output for ADMIN_PASSWORD

    # Generate session secret
    openssl rand -base64 32
    # Copy output for SESSION_SECRET
    ```

    **Step 3: Configure Vercel Environment Variables**
    1. Go to https://vercel.com and import project (or go to existing project)
    2. Go to Settings > Environment Variables
    3. Add these variables for **Production** environment:
       - `CONVEX_DEPLOY_KEY` = (the key from Step 1)
       - `ADMIN_PASSWORD` = (password from Step 2)
       - `SESSION_SECRET` = (secret from Step 2)

    **Step 4: Deploy**
    Either:
    - Push to git (Vercel auto-deploys on push)
    - Or run: `npx vercel --prod`

    **Step 5: Verify**
    1. Visit production URL
    2. Navigate to /apply - form should load
    3. Navigate to /admin/login - should show login page
    4. Log in with ADMIN_PASSWORD - should access dashboard
  </instructions>
  <resume-signal>Provide the production URL (e.g., https://ft-form.vercel.app) to confirm deployment</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Verify Production Deployment</name>
  <files></files>
  <action>
    After user provides production URL, verify:

    1. Curl the main page: `curl -I [PRODUCTION_URL]` - should return 200
    2. Curl the apply page: `curl -I [PRODUCTION_URL]/apply` - should return 200
    3. Curl the admin page: `curl -I [PRODUCTION_URL]/admin` - should redirect to login (302/307)
    4. Check Convex connection by visiting /apply and confirming no console errors

    If any checks fail, troubleshoot based on error messages.
  </action>
  <verify>
    All curl commands return expected status codes
    No JavaScript errors in browser console at /apply
    Admin login flow works end-to-end
  </verify>
  <done>
    Production deployment verified and accessible
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. vercel.json exists with correct buildCommand
2. Application accessible at production URL
3. /apply form loads and connects to Convex
4. /admin requires authentication
5. /admin/login accepts configured password
6. Admin dashboard shows applications from production database
</verification>

<success_criteria>
- Application deployed to Vercel production
- Convex backend deployed to production environment
- Admin authentication working with production credentials
- Form submission works and saves to production database
- Production URL provided and verified
</success_criteria>

<output>
After completion, create `.planning/phases/07-mobile-optimization-deployment/07-02-SUMMARY.md`
</output>
