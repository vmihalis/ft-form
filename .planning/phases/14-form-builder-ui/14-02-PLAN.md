---
phase: 14-form-builder-ui
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - src/app/admin/forms/new/page.tsx
  - src/app/admin/forms/[formId]/page.tsx
  - src/components/form-builder/FormBuilder.tsx
  - src/components/form-builder/FormMetadataForm.tsx
  - src/components/form-builder/StepTabs.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can create new form with name and URL slug"
    - "Admin can navigate to form builder page after creation"
    - "Form builder displays three-panel layout"
  artifacts:
    - path: "src/app/admin/forms/new/page.tsx"
      provides: "New form creation page"
    - path: "src/app/admin/forms/[formId]/page.tsx"
      provides: "Form builder edit page"
    - path: "src/components/form-builder/FormBuilder.tsx"
      provides: "Three-panel form builder container"
    - path: "src/components/form-builder/FormMetadataForm.tsx"
      provides: "Form name/slug/description editor"
    - path: "src/components/form-builder/StepTabs.tsx"
      provides: "Step selector tabs"
  key_links:
    - from: "src/app/admin/forms/new/page.tsx"
      to: "api.forms.create"
      via: "useMutation hook"
    - from: "src/app/admin/forms/[formId]/page.tsx"
      to: "FormBuilder"
      via: "component import"
    - from: "FormBuilder"
      to: "useFormBuilderStore"
      via: "store subscription"
---

<objective>
Create new form page, form builder edit page with three-panel layout, and step management tabs.

Purpose: Fulfill BUILD-01 (create form with name/slug) and establish the form builder shell that other components plug into.
Output: Working form creation flow and empty builder shell ready for field palette/canvas/property panel.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-form-builder-ui/14-RESEARCH.md
@.planning/phases/14-form-builder-ui/14-01-SUMMARY.md
@src/lib/stores/form-builder-store.ts
@convex/forms.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create new form page</name>
  <files>src/app/admin/forms/new/page.tsx</files>
  <action>
Create src/app/admin/forms/new/page.tsx as client component:

1. "use client" directive
2. Form with fields:
   - Form Name (required text input)
   - URL Slug (required text input, prefixed with "/apply/" display)
   - Description (optional textarea)
3. Use useMutation(api.forms.create)
4. On submit:
   - Call mutation with { name, slug, description }
   - On success: router.push(`/admin/forms/${formId}`)
   - On error: Display error message (slug conflicts, validation errors)
5. Include Cancel button that navigates back to /admin/forms

Layout:
- Centered card, max-w-md
- "Create New Form" heading
- Slug field shows "/apply/" prefix as muted text before input
- Slug description: "Lowercase letters, numbers, and hyphens only"

Use shadcn: Card, CardHeader, CardTitle, CardContent, Input, Textarea, Button, Label
Use toast (sonner) for error feedback
  </action>
  <verify>npm run build succeeds; can navigate to /admin/forms/new and see form</verify>
  <done>New form page accepts name/slug/description and creates form via mutation</done>
</task>

<task type="auto">
  <name>Task 2: Create form builder edit page</name>
  <files>src/app/admin/forms/[formId]/page.tsx</files>
  <action>
Create src/app/admin/forms/[formId]/page.tsx:

1. Server component with auth check (same pattern as /admin/page.tsx)
2. Pass formId param to FormBuilder client component
3. Header with:
   - Back button (arrow icon linking to /admin/forms)
   - Form name (from useQuery, show "Loading..." while loading)
   - Save button (calls forms.update with JSON.stringify(schema))
   - Preview toggle button
4. Render FormBuilder component with formId prop

Page structure:
```tsx
export default async function FormBuilderPage({ params }) {
  // Auth check
  // Return FormBuilderWrapper with formId
}

// Client component that handles data loading
function FormBuilderWrapper({ formId }) {
  const form = useQuery(api.forms.getById, { formId });
  const { initSchema, setFormId } = useFormBuilderStore();

  useEffect(() => {
    if (form) {
      setFormId(formId);
      initSchema(form.draftSchema);
    }
  }, [form]);

  if (!form) return <LoadingSkeleton />;
  return <FormBuilder formId={formId} formName={form.name} />;
}
```

Note: params is now a Promise in Next.js 16 - use await params to get formId.
  </action>
  <verify>npm run build succeeds; can navigate to /admin/forms/[formId] and see builder page</verify>
  <done>Form builder page loads form from database and initializes Zustand store</done>
</task>

<task type="auto">
  <name>Task 3: Create FormBuilder container and supporting components</name>
  <files>src/components/form-builder/FormBuilder.tsx, src/components/form-builder/FormMetadataForm.tsx, src/components/form-builder/StepTabs.tsx</files>
  <action>
Create three-panel form builder layout:

1. src/components/form-builder/FormBuilder.tsx:
   - Three-column flex layout: left (w-64), center (flex-1), right (w-80)
   - Left: Field palette placeholder ("Field Types" heading, will add buttons in Plan 03)
   - Center: Step tabs + form canvas placeholder
   - Right: PropertyPanel or FormMetadataForm (based on selectedFieldId)
   - Full height: h-[calc(100vh-4rem)] with overflow-y-auto on each panel

2. src/components/form-builder/FormMetadataForm.tsx:
   - Shown in right panel when no field is selected
   - Editable form name, slug, description (from useQuery data)
   - Uses useMutation(api.forms.update) on blur/change
   - Shows "Editing Draft" status badge
   - Settings section: submitButtonText, successMessage

3. src/components/form-builder/StepTabs.tsx:
   - Horizontal tabs showing each step in schema
   - Selected step highlighted
   - Add Step button (+ icon) at end
   - Each tab shows step title, click to select
   - Double-click or edit icon to rename step inline
   - Delete icon (only if >1 step exists)

Layout CSS:
- Left panel: border-r, bg-muted/30, p-4
- Center panel: p-6, bg-background
- Right panel: border-l, p-4, bg-muted/30
  </action>
  <verify>npm run build succeeds; FormBuilder renders three-panel layout with step tabs</verify>
  <done>FormBuilder shows three panels with step tabs and form metadata editor</done>
</task>

</tasks>

<verification>
- /admin/forms/new creates form and redirects to builder
- /admin/forms/[formId] loads form and displays three-panel layout
- Step tabs show steps from schema
- Form metadata panel shows form name/slug/description
- Adding steps via button updates store and UI
</verification>

<success_criteria>
1. CREATE NEW FORM: /admin/forms/new accepts name/slug, creates form, redirects to builder
2. THREE PANELS: FormBuilder displays left/center/right panels at correct widths
3. STEP TABS: Steps render as tabs, can add new steps
4. METADATA: Form name/slug/description editable in right panel when no field selected
5. STORE SYNC: Zustand store initializes from database on page load
</success_criteria>

<output>
After completion, create `.planning/phases/14-form-builder-ui/14-02-SUMMARY.md`
</output>
