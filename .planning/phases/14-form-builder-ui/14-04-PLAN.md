---
phase: 14-form-builder-ui
plan: 04
type: execute
wave: 3
depends_on: ["14-02", "14-03"]
files_modified:
  - src/components/form-builder/PropertyPanel.tsx
  - src/components/form-builder/OptionsEditor.tsx
  - src/components/form-builder/ValidationEditor.tsx
  - src/components/form-builder/FormBuilder.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can configure field properties (label, placeholder, required, help text)"
    - "Admin can remove fields from form"
    - "Admin can configure dropdown/radio options"
  artifacts:
    - path: "src/components/form-builder/PropertyPanel.tsx"
      provides: "Field property editor"
      exports: ["PropertyPanel"]
    - path: "src/components/form-builder/OptionsEditor.tsx"
      provides: "Options list editor for select/radio"
    - path: "src/components/form-builder/ValidationEditor.tsx"
      provides: "Validation rules editor"
  key_links:
    - from: "PropertyPanel"
      to: "useFormBuilderStore.updateField"
      via: "form onChange handlers"
    - from: "PropertyPanel"
      to: "useFormBuilderStore.removeField"
      via: "delete button onClick"
    - from: "FormBuilder"
      to: "PropertyPanel"
      via: "conditional render based on selectedFieldId"
---

<objective>
Create property panel for editing field configuration, options editor for select/radio fields, and validation settings.

Purpose: Fulfill BUILD-04 (configure field properties) and BUILD-05 (remove fields), enabling complete field customization.
Output: Working property panel that edits field properties and updates store in real-time.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-form-builder-ui/14-RESEARCH.md
@.planning/phases/14-form-builder-ui/14-02-SUMMARY.md
@.planning/phases/14-form-builder-ui/14-03-SUMMARY.md
@src/lib/stores/form-builder-store.ts
@src/types/form-schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create property panel component</name>
  <files>src/components/form-builder/PropertyPanel.tsx</files>
  <action>
Create src/components/form-builder/PropertyPanel.tsx:

Props: { fieldId: string }

1. Get field data: const field = useFormBuilderStore(s => s.getFieldById(fieldId))
2. Get actions: updateField, removeField from store

3. Use react-hook-form for field editing:
   - useForm with defaultValues: field
   - useEffect to reset form when fieldId changes
   - Watch for changes and call updateField (debounced or on blur)

4. Sections:

   **Header**
   - Field type icon + "Field Properties" title
   - Delete button (Trash2 icon, text-destructive, confirms before delete)

   **Basic Properties** (all fields)
   - Label (Input, required)
   - Placeholder (Input, optional)
   - Description/Help text (Textarea, optional, 2 rows)
   - Required toggle (Checkbox with label)

   **Type-Specific**
   - If select/radio: Render OptionsEditor
   - If number: min/max number inputs
   - If text/textarea: minLength/maxLength inputs
   - If file: accept file types (preset options or custom)

5. Delete confirmation:
   - Use AlertDialog from shadcn
   - "Delete Field" title, "This cannot be undone" description
   - Cancel and Delete buttons

Use shadcn: Input, Textarea, Checkbox, Label, Button, Separator, AlertDialog
  </action>
  <verify>npx tsc --noEmit passes; PropertyPanel renders field editing form</verify>
  <done>PropertyPanel shows field properties and updates store on change</done>
</task>

<task type="auto">
  <name>Task 2: Create options editor for select/radio fields</name>
  <files>src/components/form-builder/OptionsEditor.tsx</files>
  <action>
Create src/components/form-builder/OptionsEditor.tsx:

Props: { options: FieldOption[], onChange: (options: FieldOption[]) => void }

Features:
1. List of option inputs with:
   - Drag handle (optional, for reordering)
   - Label input field
   - Delete button (X icon)

2. "Add Option" button at bottom

3. Actions:
   - addOption: Add { value: `option_${nanoid(6)}`, label: '' }
   - updateOption(index, { label }): Update label (value stays unchanged)
   - removeOption(index): Remove from array

4. Auto-generate value from label (optional):
   - On label blur, if value empty, generate from label (lowercase, underscores)

5. Validation warning:
   - Show "At least one option required" if options.length === 0
   - Red text, not blocking (blocking happens on publish)

6. Empty option label warning:
   - Show subtle indicator on empty label options

Layout:
- Compact list with small spacing
- Each option: flex row with input + delete button
- Add button: variant="ghost", size="sm", Plus icon
  </action>
  <verify>npx tsc --noEmit passes; OptionsEditor allows adding/editing/removing options</verify>
  <done>OptionsEditor manages option list with add/edit/remove</done>
</task>

<task type="auto">
  <name>Task 3: Create validation editor and integrate property panel</name>
  <files>src/components/form-builder/ValidationEditor.tsx, src/components/form-builder/FormBuilder.tsx</files>
  <action>
1. Create src/components/form-builder/ValidationEditor.tsx:

Props: { field: FormField, onChange: (validation: FieldValidation) => void }

Show validation options based on field type:

- text/textarea:
  - Min length (number input)
  - Max length (number input)
  - Pattern (select with presets + custom option)
  - Presets: None, Phone, URL, Custom regex

- number:
  - Min value (number input)
  - Max value (number input)

- email: (no additional validation needed, type handles it)

- date: (future: min/max date - skip for now)

- file:
  - Max file size (preset: 50MB)
  - Accepted types (checkboxes: Images, PDFs, Documents)

Custom error message input (for all types).

2. Update src/components/form-builder/FormBuilder.tsx:
   - Import PropertyPanel
   - Right panel logic:
     - If selectedFieldId exists: render PropertyPanel with fieldId
     - If no selectedFieldId: render FormMetadataForm
   - Ensure FormCanvas receives selectField handler

Integration check:
- Clicking field in canvas selects it, shows PropertyPanel
- Clicking empty area deselects, shows FormMetadataForm
- Editing in PropertyPanel updates store (visible in canvas)
  </action>
  <verify>npm run build succeeds; selecting field shows PropertyPanel, editing updates canvas</verify>
  <done>PropertyPanel integrated with FormBuilder, validation editor shows type-specific options</done>
</task>

</tasks>

<verification>
- Clicking field shows PropertyPanel in right panel
- Editing label updates field preview in canvas
- Required toggle updates field
- Delete button removes field with confirmation
- Select/radio fields show OptionsEditor
- Adding/removing options works
- Clicking outside fields shows FormMetadataForm
</verification>

<success_criteria>
1. SELECTION: Clicking field shows PropertyPanel, clicking away shows FormMetadataForm
2. EDIT LABEL: Changing label updates field preview in real-time
3. REQUIRED: Toggle updates field.required
4. DELETE: Button with confirmation removes field
5. OPTIONS: Select/radio fields show options list, can add/edit/remove
6. VALIDATION: Type-appropriate validation inputs shown
</success_criteria>

<output>
After completion, create `.planning/phases/14-form-builder-ui/14-04-SUMMARY.md`
</output>
