---
phase: 14-form-builder-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/lib/stores/form-builder-store.ts
  - src/app/admin/forms/page.tsx
  - src/components/form-builder/FormsList.tsx
autonomous: true

must_haves:
  truths:
    - "Form builder dependencies are installed and available"
    - "Form builder state can be managed via Zustand store"
    - "Admin can see list of all forms in admin dashboard"
  artifacts:
    - path: "src/lib/stores/form-builder-store.ts"
      provides: "Zustand store for form builder state management"
      exports: ["useFormBuilderStore"]
    - path: "src/app/admin/forms/page.tsx"
      provides: "Admin forms list page"
    - path: "src/components/form-builder/FormsList.tsx"
      provides: "Forms table component"
  key_links:
    - from: "src/app/admin/forms/page.tsx"
      to: "FormsList"
      via: "component import"
    - from: "FormsList"
      to: "api.forms.list"
      via: "useQuery hook"
---

<objective>
Install dnd-kit dependencies, create Zustand store for form builder state, and build admin forms list page.

Purpose: Establish foundation for form builder - dependencies, state management, and entry point for managing forms.
Output: Working admin forms list page at /admin/forms with Zustand store ready for builder components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-form-builder-ui/14-RESEARCH.md
@src/types/form-schema.ts
@convex/forms.ts
@src/app/admin/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dnd-kit dependencies</name>
  <files>package.json</files>
  <action>
Install required packages for drag-and-drop form builder:
- @dnd-kit/core (^6.3.1) - Core DnD primitives
- @dnd-kit/sortable (^10.0.0) - Sortable list preset
- @dnd-kit/utilities (^3.2.2) - CSS transform utilities
- nanoid (^5.0.9) - Unique field ID generation

Run: npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities nanoid

Note: Zustand is already in the project, no need to install.
  </action>
  <verify>npm list @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities nanoid shows all packages installed</verify>
  <done>All 4 packages in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create form builder Zustand store</name>
  <files>src/lib/stores/form-builder-store.ts</files>
  <action>
Create Zustand store for form builder state management:

1. Create src/lib/stores/ directory if needed
2. Create form-builder-store.ts with:

State:
- formId: string | null - Current form being edited
- schema: FormSchema - Current draft schema
- isDirty: boolean - Unsaved changes flag
- selectedFieldId: string | null - Currently selected field
- selectedStepIndex: number - Currently selected step
- previewMode: 'edit' | 'preview' - Current view mode

Actions:
- initSchema(schema: FormSchema) - Initialize from database
- setFormId(formId: string | null) - Set current form
- addField(stepIndex: number, type: FieldType) - Add new field to step
- updateField(fieldId: string, updates: Partial<FormField>) - Update field props
- removeField(fieldId: string) - Remove field from step
- reorderFields(stepIndex: number, oldIndex: number, newIndex: number) - Reorder fields
- selectField(fieldId: string | null) - Select field for editing
- addStep() - Add new step
- updateStep(stepIndex: number, updates: Partial<FormStep>) - Update step props
- removeStep(stepIndex: number) - Remove step (min 1)
- reorderSteps(oldIndex: number, newIndex: number) - Reorder steps
- selectStep(stepIndex: number) - Select step
- getFieldById(fieldId: string) - Helper to find field
- getStepByFieldId(fieldId: string) - Helper to find step containing field
- markClean() - Clear dirty flag after save
- resetBuilder() - Reset to initial state

Use nanoid() for field IDs (import { nanoid } from 'nanoid').
Default empty schema: { steps: [], settings: { submitButtonText: 'Submit', successMessage: 'Thank you!' } }

Import types from @/types/form-schema.
  </action>
  <verify>TypeScript compiles without errors: npx tsc --noEmit</verify>
  <done>form-builder-store.ts exports useFormBuilderStore with all actions</done>
</task>

<task type="auto">
  <name>Task 3: Create admin forms list page</name>
  <files>src/app/admin/forms/page.tsx, src/components/form-builder/FormsList.tsx</files>
  <action>
Create forms management page:

1. Create src/app/admin/forms/page.tsx (server component):
   - Same auth pattern as src/app/admin/page.tsx
   - Header with "Forms" title and "New Form" button (links to /admin/forms/new)
   - Render FormsList client component

2. Create src/components/form-builder/FormsList.tsx (client component):
   - "use client" directive
   - Use useQuery(api.forms.list) to fetch forms
   - Display table with columns: Name, Slug (with /apply/ prefix), Status (badge), Version, Created, Actions
   - Status badges: draft (yellow), published (green), archived (gray)
   - Each row links to /admin/forms/[formId] for editing
   - Show loading skeleton while data loads
   - Show empty state if no forms exist

Use existing shadcn components: Table, Badge, Button, Skeleton
Use lucide-react icons: Plus, ExternalLink
Format dates with toLocaleDateString()
  </action>
  <verify>npm run build compiles successfully; navigating to /admin/forms shows forms list page</verify>
  <done>Forms list page shows all forms from database with status badges and links to edit</done>
</task>

</tasks>

<verification>
- npm list @dnd-kit/core shows version ^6
- npx tsc --noEmit passes
- npm run build succeeds
- /admin/forms accessible (redirects to login if not authenticated)
</verification>

<success_criteria>
1. dnd-kit packages installed in package.json
2. form-builder-store.ts exports useFormBuilderStore
3. /admin/forms page renders with FormsList
4. FormsList displays forms from api.forms.list query
5. Status badges render correctly for draft/published/archived
</success_criteria>

<output>
After completion, create `.planning/phases/14-form-builder-ui/14-01-SUMMARY.md`
</output>
