---
phase: 24-polish-ux
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/form-builder/FormCard.tsx
  - src/components/form-builder/FormQuickActions.tsx
  - src/components/form-builder/FormsList.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Form duplication shows loading state during operation"
    - "User sees visual feedback when duplicate action is in progress"
    - "Loading state prevents duplicate clicks during operation"
  artifacts:
    - path: "src/components/form-builder/FormCard.tsx"
      provides: "Card with loading state prop"
      contains: "isLoading"
    - path: "src/components/form-builder/FormQuickActions.tsx"
      provides: "Loading indicator during duplicate"
      contains: "Loader2"
    - path: "src/components/form-builder/FormsList.tsx"
      provides: "Pass duplicatingId to cards"
      contains: "duplicatingId"
  key_links:
    - from: "src/components/form-builder/FormsList.tsx"
      to: "FormCard"
      via: "isLoading prop"
      pattern: "isLoading.*duplicatingId"
---

<objective>
Add loading state for form duplication operation

Purpose: Close UX-04 gap - form duplication lacks visible loading indicator. While the mutation uses local state (duplicatingId), the UI doesn't show the user that something is happening. This plan adds a visible loading state to the duplicate action.

Output: FormCard shows loading overlay and FormQuickActions shows spinner during duplication
</objective>

<execution_context>
@/home/memehalis/.claude/get-shit-done/workflows/execute-plan.md
@/home/memehalis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/components/form-builder/FormsList.tsx
@src/components/form-builder/FormCard.tsx
@src/components/form-builder/FormQuickActions.tsx
@src/components/form-builder/FormsGrid.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add loading state to FormQuickActions</name>
  <files>src/components/form-builder/FormQuickActions.tsx</files>
  <action>
Update FormQuickActions to show a loading spinner when duplicate is in progress:

1. Add `isDuplicating` prop to FormQuickActionsProps interface
2. Import `Loader2` from lucide-react (add to existing imports)
3. When isDuplicating is true:
   - Show Loader2 spinning icon instead of Copy icon in the Duplicate menu item
   - Add "animate-spin" class to Loader2
   - Disable the Duplicate menu item (prevent double-clicks)
   - Change text to "Duplicating..." to indicate progress

Update the Duplicate menu item:
```tsx
{onDuplicate && (
  <DropdownMenuItem
    onClick={(e) => { e.stopPropagation(); onDuplicate(); }}
    disabled={isDuplicating}
  >
    {isDuplicating ? (
      <>
        <Loader2 className="h-4 w-4 mr-2 animate-spin" />
        Duplicating...
      </>
    ) : (
      <>
        <Copy className="h-4 w-4 mr-2" />
        Duplicate
      </>
    )}
  </DropdownMenuItem>
)}
```
  </action>
  <verify>
grep -n "isDuplicating" src/components/form-builder/FormQuickActions.tsx shows prop usage
grep -n "Loader2" src/components/form-builder/FormQuickActions.tsx shows import and usage
grep -n "Duplicating" src/components/form-builder/FormQuickActions.tsx shows loading text
  </verify>
  <done>FormQuickActions shows spinning loader and "Duplicating..." text when isDuplicating is true</done>
</task>

<task type="auto">
  <name>Task 2: Add loading overlay to FormCard</name>
  <files>src/components/form-builder/FormCard.tsx</files>
  <action>
Update FormCard to show a loading state when the form is being duplicated:

1. Add `isLoading` prop to FormCardProps interface
2. Pass `isDuplicating={isLoading}` to FormQuickActions

3. When isLoading is true, add a subtle overlay effect to the card:
   - Add conditional opacity class to the card content (not the motion.div wrapper)
   - Add a subtle pulse animation or reduced opacity (opacity-60) to indicate loading
   - Optionally show a small loading indicator in the card

Implementation approach - use conditional classes:
```tsx
<motion.div
  className={cn(
    "glass-card rounded-2xl p-6 min-h-[180px] flex flex-col",
    isLoading && "pointer-events-none"
  )}
  // ... existing motion props
>
  {/* Add loading overlay */}
  {isLoading && (
    <div className="absolute inset-0 bg-background/50 rounded-2xl flex items-center justify-center z-10">
      <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
    </div>
  )}

  {/* Existing content with conditional opacity */}
  <div className={cn(isLoading && "opacity-50")}>
    {/* ... existing card content */}
  </div>
</motion.div>
```

Note: The motion.div needs `relative` class for the absolute overlay to work.

4. Import Loader2 from lucide-react
5. Import cn from @/lib/utils (should already exist)
  </action>
  <verify>
grep -n "isLoading" src/components/form-builder/FormCard.tsx shows prop in interface and usage
grep -n "Loader2" src/components/form-builder/FormCard.tsx shows import and render
grep -n "isDuplicating" src/components/form-builder/FormCard.tsx shows prop passed to FormQuickActions
  </verify>
  <done>FormCard shows loading overlay with spinner when isLoading is true, and passes state to FormQuickActions</done>
</task>

<task type="auto">
  <name>Task 3: Wire loading state through FormsGrid and FormsList</name>
  <files>
    src/components/form-builder/FormsGrid.tsx
    src/components/form-builder/FormsList.tsx
  </files>
  <action>
Update the component chain to pass duplicatingId through:

**FormsGrid.tsx:**
1. Add `duplicatingId` prop to FormsGridProps interface: `duplicatingId?: Id<"forms"> | null`
2. Pass `isLoading={form._id === duplicatingId}` to each FormCard

**FormsList.tsx:**
1. Pass `duplicatingId={duplicatingId}` to FormsGrid component

The chain should be:
FormsList (has duplicatingId state) → FormsGrid (receives duplicatingId prop) → FormCard (receives isLoading prop) → FormQuickActions (receives isDuplicating prop)

In FormsGrid, the FormCard render should become:
```tsx
<FormCard
  key={form._id}
  form={form}
  onDuplicate={() => onDuplicate(form._id)}
  isLoading={form._id === duplicatingId}
/>
```
  </action>
  <verify>
grep -n "duplicatingId" src/components/form-builder/FormsGrid.tsx shows prop in interface and usage
grep -n "duplicatingId" src/components/form-builder/FormsList.tsx shows prop passed to FormsGrid
npm run build completes without TypeScript errors
  </verify>
  <done>duplicatingId flows from FormsList → FormsGrid → FormCard → FormQuickActions, showing loading state during duplication</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Navigate to Forms list, click duplicate on a form
3. Visual feedback: Card shows loading overlay, dropdown shows "Duplicating..." with spinner
4. Duplicate button is disabled during operation (prevents double-clicks)
5. After duplication completes, redirects to new form (existing behavior preserved)
</verification>

<success_criteria>
- Form duplication shows visible loading indicator (spinner on card)
- Dropdown menu shows "Duplicating..." text with spinner icon
- Duplicate action is disabled during operation
- Loading state clears after operation completes
- All existing duplication functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/24-polish-ux/24-05-SUMMARY.md`
</output>
