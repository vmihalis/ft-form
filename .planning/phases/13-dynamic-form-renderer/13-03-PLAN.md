---
phase: 13-dynamic-form-renderer
plan: 03
type: execute
wave: 3
depends_on: ["13-01", "13-02"]
files_modified:
  - src/components/dynamic-form/DynamicFormPage.tsx
  - src/components/dynamic-form/DynamicFormRenderer.tsx
  - src/components/dynamic-form/DynamicStepContent.tsx
  - src/components/dynamic-form/DynamicNavigation.tsx
  - src/components/dynamic-form/DynamicProgressIndicator.tsx
  - src/components/dynamic-form/DynamicWelcome.tsx
  - src/components/dynamic-form/DynamicReview.tsx
  - src/components/dynamic-form/DynamicConfirmation.tsx
  - src/app/apply/[slug]/page.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Form displays Welcome step with form name"
    - "Form displays content steps with dynamic fields"
    - "Form displays Review step with all responses"
    - "Form displays Confirmation after successful submit"
    - "Navigation validates current step before advancing"
    - "Progress indicator shows correct step count"
    - "Submission creates record with formVersionId"
  artifacts:
    - path: "src/components/dynamic-form/DynamicFormPage.tsx"
      provides: "Container with data fetching and store hydration"
      min_lines: 40
    - path: "src/components/dynamic-form/DynamicFormRenderer.tsx"
      provides: "Form logic with react-hook-form and Convex mutation"
      min_lines: 60
    - path: "src/components/dynamic-form/DynamicStepContent.tsx"
      provides: "Step routing with animations"
      min_lines: 40
    - path: "src/components/dynamic-form/DynamicNavigation.tsx"
      provides: "Back/Next/Submit buttons with per-step validation"
      min_lines: 50
    - path: "src/components/dynamic-form/DynamicReview.tsx"
      provides: "Auto-generated review from schema"
      min_lines: 50
  key_links:
    - from: "src/components/dynamic-form/DynamicFormRenderer.tsx"
      to: "convex/submissions.ts"
      via: "useMutation(api.submissions.submit)"
      pattern: "useMutation.*submissions.submit"
    - from: "src/components/dynamic-form/DynamicStepContent.tsx"
      to: "src/components/dynamic-form/fields/index.tsx"
      via: "DynamicField component"
      pattern: "import.*DynamicField"
    - from: "src/app/apply/[slug]/page.tsx"
      to: "src/components/dynamic-form/DynamicFormPage.tsx"
      via: "DynamicFormPage component"
      pattern: "import.*DynamicFormPage"
---

<objective>
Create dynamic form container, step components, and complete the form flow

Purpose: Complete the Typeform-style dynamic form experience with validation, navigation, and submission
Output: Full dynamic form renderer with Welcome -> Steps -> Review -> Confirmation flow
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-dynamic-form-renderer/13-RESEARCH.md

# Plan 01 outputs
@src/app/apply/[slug]/page.tsx
@src/lib/schemas/dynamic-form.ts
@src/lib/stores/dynamic-form-store.ts

# Plan 02 outputs
@src/components/dynamic-form/fields/index.tsx

# Existing patterns to follow
@src/components/form/MultiStepForm.tsx
@src/components/form/StepContent.tsx
@src/components/form/NavigationButtons.tsx
@src/components/form/ProgressIndicator.tsx
@src/components/form/steps/ReviewStep.tsx
@src/components/form/steps/WelcomeStep.tsx
@src/components/form/steps/ConfirmationStep.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DynamicFormPage container and supporting step components</name>
  <files>
    - src/components/dynamic-form/DynamicFormPage.tsx
    - src/components/dynamic-form/DynamicWelcome.tsx
    - src/components/dynamic-form/DynamicConfirmation.tsx
    - src/components/dynamic-form/DynamicProgressIndicator.tsx
  </files>
  <action>
Create the page container and simpler step components:

DynamicFormPage.tsx - Container with data fetching:
```typescript
"use client";

import { useEffect } from "react";
import { useQuery } from "convex/react";
import { api } from "../../../convex/_generated/api";
import { useDynamicFormStore } from "@/lib/stores/dynamic-form-store";
import { DynamicFormRenderer } from "./DynamicFormRenderer";

interface DynamicFormPageProps {
  slug: string;
}

export function DynamicFormPage({ slug }: DynamicFormPageProps) {
  const form = useQuery(api.forms.getBySlug, { slug });
  const isHydrated = useDynamicFormStore((state) => state.isHydrated);
  const initDraft = useDynamicFormStore((state) => state.initDraft);
  const getDraft = useDynamicFormStore((state) => state.getDraft);

  // Hydrate store on mount
  useEffect(() => {
    useDynamicFormStore.persist.rehydrate();
  }, []);

  // Initialize draft when form loads
  useEffect(() => {
    if (form && isHydrated) {
      const draft = getDraft(slug);
      // Only init if no draft or version changed
      if (!draft || draft.versionId !== form.versionId) {
        initDraft(slug, form.versionId);
      }
    }
  }, [form, isHydrated, slug, getDraft, initDraft]);

  // Loading state
  if (form === undefined) {
    return (
      <div className="flex min-h-[400px] items-center justify-center">
        <div className="text-center">
          <div className="h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto" />
          <p className="mt-4 text-muted-foreground">Loading form...</p>
        </div>
      </div>
    );
  }

  // Not found state
  if (form === null) {
    return (
      <div className="flex min-h-[400px] items-center justify-center">
        <div className="text-center">
          <h2 className="text-2xl font-semibold mb-2">Form Not Found</h2>
          <p className="text-muted-foreground">
            This form doesn&apos;t exist or is no longer accepting submissions.
          </p>
        </div>
      </div>
    );
  }

  // Wait for hydration
  if (!isHydrated) {
    return (
      <div className="flex min-h-[400px] items-center justify-center">
        <div className="text-center">
          <div className="h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto" />
          <p className="mt-4 text-muted-foreground">Restoring your progress...</p>
        </div>
      </div>
    );
  }

  return (
    <DynamicFormRenderer
      slug={slug}
      schema={form.schema}
      versionId={form.versionId}
      formName={form.formName}
    />
  );
}
```

DynamicWelcome.tsx - Generic welcome step:
```typescript
"use client";

import Image from "next/image";

interface DynamicWelcomeProps {
  formName: string;
}

export function DynamicWelcome({ formName }: DynamicWelcomeProps) {
  return (
    <div className="text-center py-8 sm:py-12">
      <div className="mx-auto mb-10 w-24 h-24 sm:w-28 sm:h-28 lg:w-32 lg:h-32 relative">
        <Image
          src="/logo.jpg"
          alt="Frontier Tower"
          fill
          className="object-contain"
          priority
        />
      </div>

      <h1 className="text-4xl sm:text-5xl lg:text-6xl font-bold tracking-tight font-display">
        {formName}
      </h1>

      <p className="mt-8 text-lg sm:text-xl lg:text-2xl text-muted-foreground max-w-2xl mx-auto px-4 leading-relaxed">
        Please complete this form to submit your application.
        Your progress is automatically saved.
      </p>
    </div>
  );
}
```

DynamicConfirmation.tsx - Success step:
```typescript
"use client";

import { CheckCircle2 } from "lucide-react";
import { Button } from "@/components/ui/button";
import Image from "next/image";

interface DynamicConfirmationProps {
  message?: string;
}

export function DynamicConfirmation({ message }: DynamicConfirmationProps) {
  return (
    <div className="text-center py-8 sm:py-12">
      <div className="mx-auto mb-8 w-20 h-20 sm:w-24 sm:h-24 relative">
        <Image
          src="/logo.jpg"
          alt="Frontier Tower"
          fill
          className="object-contain"
          priority
        />
      </div>

      <div className="mx-auto mb-8 flex h-20 w-20 items-center justify-center rounded-full bg-green-100 dark:bg-green-900/30">
        <CheckCircle2 className="h-12 w-12 text-green-600 dark:text-green-400" />
      </div>

      <h2 className="text-3xl sm:text-4xl lg:text-5xl font-bold font-display">
        Submission Complete!
      </h2>

      <p className="mt-6 text-lg sm:text-xl text-muted-foreground max-w-lg mx-auto leading-relaxed">
        {message || "Thank you for your submission. We will review it and get back to you soon."}
      </p>

      <div className="mt-10">
        <Button asChild variant="outline" size="lg">
          <a href="https://frontiertower.io" target="_blank" rel="noopener noreferrer">
            Visit Frontier Tower
          </a>
        </Button>
      </div>
    </div>
  );
}
```

DynamicProgressIndicator.tsx:
```typescript
"use client";

import { Check } from "lucide-react";
import { cn } from "@/lib/utils";

interface DynamicProgressIndicatorProps {
  currentStep: number;    // 0 = welcome, 1-N = content, N+1 = review
  totalContentSteps: number;  // Number of schema steps
  completedSteps: number[];
}

export function DynamicProgressIndicator({
  currentStep,
  totalContentSteps,
  completedSteps,
}: DynamicProgressIndicatorProps) {
  // Show steps 1 through N+1 (content steps + review)
  const displaySteps = Array.from({ length: totalContentSteps + 1 }, (_, i) => i + 1);

  return (
    <nav aria-label="Form progress" className="w-full">
      <span className="sr-only">
        Step {currentStep} of {totalContentSteps + 1}
      </span>

      <ol className="flex items-center justify-center">
        {displaySteps.map((stepNumber, index) => {
          const isCompleted = completedSteps.includes(stepNumber);
          const isCurrent = currentStep === stepNumber;
          const isFuture = currentStep < stepNumber;
          const isLast = index === displaySteps.length - 1;

          return (
            <li key={stepNumber} className="flex items-center">
              <div
                className={cn(
                  "relative z-10 flex h-8 w-8 sm:h-10 sm:w-10 items-center justify-center rounded-full text-xs sm:text-sm font-medium transition-colors",
                  isCompleted && "bg-primary text-primary-foreground",
                  isCurrent && !isCompleted && "bg-primary text-primary-foreground ring-2 ring-primary ring-offset-2 ring-offset-black/50",
                  isFuture && !isCompleted && "border-2 border-muted-foreground/30 text-muted-foreground bg-black/30"
                )}
                aria-current={isCurrent ? "step" : undefined}
              >
                {isCompleted ? (
                  <Check className="h-4 w-4 sm:h-5 sm:w-5" aria-hidden="true" />
                ) : (
                  <span>{stepNumber}</span>
                )}
              </div>

              {!isLast && (
                <div
                  className={cn(
                    "h-0.5 w-6 sm:w-12",
                    completedSteps.includes(stepNumber) ? "bg-primary" : "bg-muted-foreground/30"
                  )}
                  aria-hidden="true"
                />
              )}
            </li>
          );
        })}
      </ol>
    </nav>
  );
}
```
  </action>
  <verify>
- `ls src/components/dynamic-form/DynamicFormPage.tsx` exists
- `grep "DynamicFormRenderer" src/components/dynamic-form/DynamicFormPage.tsx` shows renderer usage
- `ls src/components/dynamic-form/DynamicProgressIndicator.tsx` exists
  </verify>
  <done>
- DynamicFormPage handles data fetching and store hydration
- DynamicWelcome shows form name welcome screen
- DynamicConfirmation shows success message
- DynamicProgressIndicator shows dynamic step count
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DynamicFormRenderer, DynamicStepContent, and DynamicNavigation</name>
  <files>
    - src/components/dynamic-form/DynamicFormRenderer.tsx
    - src/components/dynamic-form/DynamicStepContent.tsx
    - src/components/dynamic-form/DynamicNavigation.tsx
  </files>
  <action>
Create the core form components:

DynamicFormRenderer.tsx - Main form container with react-hook-form:
```typescript
"use client";

import { useState, useMemo, useEffect } from "react";
import { useForm, FormProvider } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { useMutation } from "convex/react";
import { api } from "../../../convex/_generated/api";
import type { Id } from "../../../convex/_generated/dataModel";
import { useDynamicFormStore } from "@/lib/stores/dynamic-form-store";
import { buildFormSchema, getStepFieldIds } from "@/lib/schemas/dynamic-form";
import { DynamicProgressIndicator } from "./DynamicProgressIndicator";
import { DynamicStepContent } from "./DynamicStepContent";
import { DynamicNavigation } from "./DynamicNavigation";
import type { FormSchema } from "@/types/form-schema";

interface DynamicFormRendererProps {
  slug: string;
  schema: FormSchema;
  versionId: Id<"formVersions">;
  formName: string;
}

export function DynamicFormRenderer({
  slug,
  schema,
  versionId,
  formName,
}: DynamicFormRendererProps) {
  // Store state
  const getDraft = useDynamicFormStore((state) => state.getDraft);
  const setCurrentStep = useDynamicFormStore((state) => state.setCurrentStep);
  const clearDraft = useDynamicFormStore((state) => state.clearDraft);

  const draft = getDraft(slug);
  const currentStep = draft?.currentStep ?? 0;
  const completedSteps = draft?.completedSteps ?? [];

  const [isSubmitting, setIsSubmitting] = useState(false);
  const [submitError, setSubmitError] = useState<string | null>(null);

  // Convex mutation
  const submitForm = useMutation(api.submissions.submit);

  // Build Zod schema from form schema
  const zodSchema = useMemo(() => buildFormSchema(schema), [schema]);

  // Step calculations
  // Structure: Welcome (0) -> Content Steps (1 to N) -> Review (N+1) -> Confirmation (N+2)
  const totalContentSteps = schema.steps.length;
  const totalSteps = totalContentSteps + 3; // welcome + content + review + confirmation
  const isWelcome = currentStep === 0;
  const isConfirmation = currentStep === totalSteps - 1;
  const isReview = currentStep === totalSteps - 2;
  const contentStepIndex = currentStep - 1; // Maps to schema.steps index

  // Initialize react-hook-form
  const methods = useForm({
    resolver: zodResolver(zodSchema),
    defaultValues: draft?.formData ?? {},
    mode: "onSubmit",
  });

  // Reset form when draft changes (e.g., version change)
  useEffect(() => {
    if (draft?.formData) {
      methods.reset(draft.formData);
    }
  }, [draft?.formData, methods]);

  // Get current step field IDs for validation
  const currentStepFieldIds = useMemo(() => {
    if (isWelcome || isReview || isConfirmation) return [];
    return getStepFieldIds(schema, contentStepIndex);
  }, [schema, contentStepIndex, isWelcome, isReview, isConfirmation]);

  // Handle form submission
  const onSubmit = async (data: Record<string, unknown>) => {
    if (currentStep !== totalSteps - 2) return; // Only submit from review

    setIsSubmitting(true);
    setSubmitError(null);

    try {
      await submitForm({
        formVersionId: versionId,
        data: JSON.stringify(data),
      });

      // Move to confirmation
      setCurrentStep(slug, totalSteps - 1);

      // Clear draft from localStorage
      clearDraft(slug);
    } catch (error) {
      console.error("Submission failed:", error);
      setSubmitError(
        error instanceof Error
          ? error.message
          : "Failed to submit. Please try again."
      );
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <FormProvider {...methods}>
      <form onSubmit={methods.handleSubmit(onSubmit)} className="space-y-8">
        {/* Progress indicator - hidden on Welcome and Confirmation */}
        {!isWelcome && !isConfirmation && (
          <div className="pb-4">
            <DynamicProgressIndicator
              currentStep={currentStep}
              totalContentSteps={totalContentSteps}
              completedSteps={completedSteps}
            />
          </div>
        )}

        {/* Step content */}
        <DynamicStepContent
          slug={slug}
          schema={schema}
          formName={formName}
          currentStep={currentStep}
          totalSteps={totalSteps}
          isSubmitting={isSubmitting}
          stepFieldIds={currentStepFieldIds}
        />

        {/* Submission error */}
        {submitError && (
          <div className="rounded-lg bg-destructive/10 border border-destructive/20 p-4 text-sm text-destructive">
            {submitError}
          </div>
        )}
      </form>
    </FormProvider>
  );
}
```

DynamicStepContent.tsx - Step routing with animations:
```typescript
"use client";

import { motion, AnimatePresence } from "motion/react";
import type { FormSchema } from "@/types/form-schema";
import { DynamicField } from "./fields";
import { DynamicWelcome } from "./DynamicWelcome";
import { DynamicReview } from "./DynamicReview";
import { DynamicConfirmation } from "./DynamicConfirmation";
import { DynamicNavigation } from "./DynamicNavigation";

interface DynamicStepContentProps {
  slug: string;
  schema: FormSchema;
  formName: string;
  currentStep: number;
  totalSteps: number;
  isSubmitting: boolean;
  stepFieldIds: string[];
}

export function DynamicStepContent({
  slug,
  schema,
  formName,
  currentStep,
  totalSteps,
  isSubmitting,
  stepFieldIds,
}: DynamicStepContentProps) {
  const isWelcome = currentStep === 0;
  const isConfirmation = currentStep === totalSteps - 1;
  const isReview = currentStep === totalSteps - 2;
  const contentStepIndex = currentStep - 1;
  const isHeroScreen = isWelcome || isConfirmation;

  const getStepContent = () => {
    if (isWelcome) {
      return <DynamicWelcome formName={formName} />;
    }

    if (isConfirmation) {
      return <DynamicConfirmation message={schema.settings.successMessage} />;
    }

    if (isReview) {
      return <DynamicReview schema={schema} slug={slug} />;
    }

    // Content step
    const step = schema.steps[contentStepIndex];
    if (!step) {
      return (
        <div className="py-12 text-center">
          <p className="text-muted-foreground">Invalid step</p>
        </div>
      );
    }

    return (
      <div className="space-y-6">
        {/* Step header */}
        <div className="text-center mb-8">
          <h2 className="text-xl sm:text-2xl font-semibold">{step.title}</h2>
          {step.description && (
            <p className="text-muted-foreground mt-2">{step.description}</p>
          )}
        </div>

        {/* Fields */}
        <div className="space-y-6">
          {step.fields.map((field) => (
            <DynamicField key={field.id} field={field} />
          ))}
        </div>
      </div>
    );
  };

  return (
    <div className={isHeroScreen ? "" : "min-h-[400px] sm:min-h-[500px]"}>
      <AnimatePresence mode="wait">
        <motion.div
          key={currentStep}
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          transition={{ duration: 0.15, ease: "easeOut" }}
        >
          {getStepContent()}
          <DynamicNavigation
            slug={slug}
            currentStep={currentStep}
            totalSteps={totalSteps}
            stepFieldIds={stepFieldIds}
            isSubmitting={isSubmitting}
          />
        </motion.div>
      </AnimatePresence>
    </div>
  );
}
```

DynamicNavigation.tsx - Navigation with per-step validation:
```typescript
"use client";

import { useFormContext } from "react-hook-form";
import { Button } from "@/components/ui/button";
import { useDynamicFormStore } from "@/lib/stores/dynamic-form-store";

interface DynamicNavigationProps {
  slug: string;
  currentStep: number;
  totalSteps: number;
  stepFieldIds: string[];
  isSubmitting: boolean;
}

export function DynamicNavigation({
  slug,
  currentStep,
  totalSteps,
  stepFieldIds,
  isSubmitting,
}: DynamicNavigationProps) {
  const { trigger, getValues } = useFormContext();
  const setCurrentStep = useDynamicFormStore((state) => state.setCurrentStep);
  const markStepCompleted = useDynamicFormStore((state) => state.markStepCompleted);
  const updateFormData = useDynamicFormStore((state) => state.updateFormData);

  const isWelcome = currentStep === 0;
  const isConfirmation = currentStep === totalSteps - 1;
  const isReview = currentStep === totalSteps - 2;
  const totalContentSteps = totalSteps - 3;

  // No buttons on confirmation
  if (isConfirmation) return null;

  const handleNext = async (e: React.MouseEvent<HTMLButtonElement>) => {
    e.preventDefault();
    e.stopPropagation();

    // Validate current step fields
    if (stepFieldIds.length > 0) {
      const isValid = await trigger(stepFieldIds);
      if (!isValid) return;
    }

    // Sync form data to store
    updateFormData(slug, getValues());

    // Mark step completed
    markStepCompleted(slug, currentStep);

    // Advance
    setCurrentStep(slug, currentStep + 1);
  };

  const handleBack = () => {
    // Save current values without validation
    updateFormData(slug, getValues());
    setCurrentStep(slug, currentStep - 1);
  };

  return (
    <div className={`flex gap-4 pt-6 ${isWelcome ? "justify-center" : "justify-between"}`}>
      {!isWelcome && (
        <Button type="button" variant="outline" onClick={handleBack}>
          Back
        </Button>
      )}

      {isReview ? (
        <Button type="submit" disabled={isSubmitting}>
          {isSubmitting ? "Submitting..." : "Submit"}
        </Button>
      ) : (
        <Button type="button" onClick={handleNext}>
          {isWelcome ? "Begin" : currentStep < totalContentSteps ? "Next" : "Review"}
        </Button>
      )}
    </div>
  );
}
```
  </action>
  <verify>
- `grep "useMutation.*submit" src/components/dynamic-form/DynamicFormRenderer.tsx` shows submission
- `grep "DynamicField" src/components/dynamic-form/DynamicStepContent.tsx` shows field rendering
- `grep "trigger" src/components/dynamic-form/DynamicNavigation.tsx` shows validation
  </verify>
  <done>
- DynamicFormRenderer manages form state and submission
- DynamicStepContent routes to correct step with animations
- DynamicNavigation handles back/next with per-step validation
  </done>
</task>

<task type="auto">
  <name>Task 3: Create DynamicReview and update route page</name>
  <files>
    - src/components/dynamic-form/DynamicReview.tsx
    - src/app/apply/[slug]/page.tsx
  </files>
  <action>
Create review component and update route to use DynamicFormPage:

DynamicReview.tsx - Auto-generated review from schema:
```typescript
"use client";

import { useFormContext } from "react-hook-form";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { useDynamicFormStore } from "@/lib/stores/dynamic-form-store";
import type { FormSchema, FormField } from "@/types/form-schema";

interface DynamicReviewProps {
  schema: FormSchema;
  slug: string;
}

interface ReviewItemProps {
  label: string;
  value: unknown;
  type: string;
}

function ReviewItem({ label, value, type }: ReviewItemProps) {
  let displayValue: React.ReactNode;

  if (value === undefined || value === null || value === "") {
    displayValue = <span className="italic text-muted-foreground">Not provided</span>;
  } else if (type === "checkbox") {
    displayValue = value ? "Yes" : "No";
  } else if (type === "file" && typeof value === "string") {
    displayValue = <span className="text-primary">File uploaded</span>;
  } else {
    displayValue = String(value);
  }

  return (
    <div className="py-2">
      <dt className="text-sm font-medium text-muted-foreground">{label}</dt>
      <dd className="mt-1 text-sm whitespace-pre-wrap break-words">{displayValue}</dd>
    </div>
  );
}

interface ReviewSectionProps {
  title: string;
  stepIndex: number;
  slug: string;
  children: React.ReactNode;
}

function ReviewSection({ title, stepIndex, slug, children }: ReviewSectionProps) {
  const setCurrentStep = useDynamicFormStore((state) => state.setCurrentStep);

  return (
    <Card>
      <CardHeader className="flex flex-row items-center justify-between py-4">
        <CardTitle className="text-lg">{title}</CardTitle>
        <Button
          type="button"
          variant="ghost"
          size="sm"
          onClick={() => setCurrentStep(slug, stepIndex)}
        >
          Edit
        </Button>
      </CardHeader>
      <CardContent className="pt-0">{children}</CardContent>
    </Card>
  );
}

export function DynamicReview({ schema, slug }: DynamicReviewProps) {
  const { getValues } = useFormContext();
  const data = getValues();

  return (
    <div className="space-y-6">
      <div className="text-center mb-8">
        <h2 className="text-xl sm:text-2xl font-semibold">Review Your Submission</h2>
        <p className="text-muted-foreground mt-2">
          Please review your information before submitting
        </p>
      </div>

      {schema.steps.map((step, stepIndex) => (
        <ReviewSection
          key={step.id}
          title={step.title}
          stepIndex={stepIndex + 1} // +1 because step 0 is welcome
          slug={slug}
        >
          <dl className="divide-y divide-border">
            {step.fields.map((field) => (
              <ReviewItem
                key={field.id}
                label={field.label}
                value={data[field.id]}
                type={field.type}
              />
            ))}
          </dl>
        </ReviewSection>
      ))}

      <p className="text-sm text-muted-foreground text-center pt-4">
        Click &quot;Submit&quot; below to finalize your submission.
      </p>
    </div>
  );
}
```

Update src/app/apply/[slug]/page.tsx to use DynamicFormPage:
Replace the placeholder content from Plan 01 with:

```typescript
import { DynamicFormPage } from "@/components/dynamic-form/DynamicFormPage";

interface PageProps {
  params: Promise<{ slug: string }>;
}

export default async function Page({ params }: PageProps) {
  const { slug } = await params;
  return (
    <main className="min-h-screen w-full max-w-3xl mx-auto px-4 py-8 sm:py-12">
      <DynamicFormPage slug={slug} />
    </main>
  );
}
```

Note: Remove the "use client" directive from the page since DynamicFormPage is already a client component and we want the page to be a server component that renders the client component.
  </action>
  <verify>
- `grep "DynamicFormPage" src/app/apply/\[slug\]/page.tsx` shows import
- `grep "ReviewSection" src/components/dynamic-form/DynamicReview.tsx` shows review sections
- `npm run build` compiles without errors
  </verify>
  <done>
- DynamicReview auto-generates review from schema
- Edit buttons navigate back to correct step
- Route page renders DynamicFormPage container
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Run `npm run build` - should compile without errors
2. Create a test form via Convex dashboard or seed script
3. Visit /apply/[test-slug] and verify:
   - Welcome step shows with form name
   - Can click Begin to start
   - Fields render based on schema
   - Next validates before advancing
   - Back works without validation
   - Review shows all answers
   - Submit creates submission in Convex
   - Confirmation step appears after submit
4. Refresh page mid-form and verify progress restored from localStorage
</verification>

<success_criteria>
- Full Typeform-style flow: Welcome -> Steps -> Review -> Confirmation
- Dynamic fields render based on schema
- Per-step validation on Next
- Form data persists in localStorage by slug
- Submission creates record with formVersionId reference
- Progress indicator shows correct step count
</success_criteria>

<output>
After completion, create `.planning/phases/13-dynamic-form-renderer/13-03-SUMMARY.md`
</output>
