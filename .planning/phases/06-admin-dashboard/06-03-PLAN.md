---
phase: 06-admin-dashboard
plan: 03
type: execute
wave: 3
depends_on: ["06-02"]
files_modified:
  - src/components/admin/ApplicationSheet.tsx
  - src/components/admin/StatusDropdown.tsx
  - src/app/admin/page.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking table row opens sheet with full application details"
    - "Sheet displays all application fields organized by section"
    - "Admin can change status via dropdown in sheet or table"
    - "Status change persists immediately via Convex mutation"
    - "Admin dashboard shows applications table instead of placeholder"
  artifacts:
    - path: "src/components/admin/ApplicationSheet.tsx"
      provides: "Slide-in panel with full application details"
      exports: ["ApplicationSheet"]
      min_lines: 80
    - path: "src/components/admin/StatusDropdown.tsx"
      provides: "Dropdown for changing application status"
      exports: ["StatusDropdown"]
      min_lines: 40
    - path: "src/app/admin/page.tsx"
      provides: "Admin dashboard with applications table"
      min_lines: 40
  key_links:
    - from: "src/components/admin/StatusDropdown.tsx"
      to: "convex/applications.ts"
      via: "useMutation for status update"
      pattern: "useMutation.*api\\.applications\\.updateStatus"
    - from: "src/app/admin/page.tsx"
      to: "src/components/admin/ApplicationsTable.tsx"
      via: "table component import"
      pattern: "ApplicationsTable"
    - from: "src/app/admin/page.tsx"
      to: "src/components/admin/ApplicationSheet.tsx"
      via: "sheet component import"
      pattern: "ApplicationSheet"
---

<objective>
Create the application detail sheet with status management and integrate everything into the admin dashboard page.

Purpose: Complete the admin dashboard with detail view and status change functionality.
Output: Fully functional admin dashboard where clicking a row opens details and status can be changed.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-admin-dashboard/06-RESEARCH.md

@convex/applications.ts
@convex/schema.ts
@src/app/admin/page.tsx
@src/components/admin/ApplicationsTable.tsx
@src/components/admin/StatusBadge.tsx
@src/components/ui/sheet.tsx
@src/components/ui/dropdown-menu.tsx
@src/lib/constants/floors.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StatusDropdown for changing application status</name>
  <files>src/components/admin/StatusDropdown.tsx</files>
  <action>
    Create StatusDropdown component:

    1. "use client" directive

    2. Imports:
       - useMutation from "convex/react"
       - api from "@/convex/_generated/api"
       - Id from "@/convex/_generated/dataModel"
       - DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger from "@/components/ui/dropdown-menu"
       - StatusBadge from "./StatusBadge"
       - ChevronDown from "lucide-react"

    3. Define status type and options:
       ```typescript
       type ApplicationStatus = "new" | "under_review" | "accepted" | "rejected";

       const STATUS_OPTIONS: { value: ApplicationStatus; label: string }[] = [
         { value: "new", label: "New" },
         { value: "under_review", label: "Under Review" },
         { value: "accepted", label: "Accepted" },
         { value: "rejected", label: "Rejected" },
       ];
       ```

    4. Component:
       ```typescript
       interface StatusDropdownProps {
         applicationId: Id<"applications">;
         currentStatus: ApplicationStatus;
       }

       export function StatusDropdown({ applicationId, currentStatus }: StatusDropdownProps) {
         const updateStatus = useMutation(api.applications.updateStatus);

         const handleStatusChange = async (status: ApplicationStatus) => {
           await updateStatus({ id: applicationId, status });
         };

         return (
           <DropdownMenu>
             <DropdownMenuTrigger className="flex items-center gap-1">
               <StatusBadge status={currentStatus} />
               <ChevronDown className="h-4 w-4" />
             </DropdownMenuTrigger>
             <DropdownMenuContent>
               {STATUS_OPTIONS.map((option) => (
                 <DropdownMenuItem
                   key={option.value}
                   onClick={() => handleStatusChange(option.value)}
                   disabled={option.value === currentStatus}
                 >
                   {option.label}
                 </DropdownMenuItem>
               ))}
             </DropdownMenuContent>
           </DropdownMenu>
         );
       }
       ```

    5. Stop event propagation on trigger click to prevent row click:
       Add onClick={(e) => e.stopPropagation()} to DropdownMenuTrigger
  </action>
  <verify>
    - StatusDropdown.tsx exists and exports StatusDropdown
    - TypeScript compiles without errors
  </verify>
  <done>
    StatusDropdown component with Convex mutation integration and event propagation handling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ApplicationSheet for viewing full application details</name>
  <files>src/components/admin/ApplicationSheet.tsx</files>
  <action>
    Create ApplicationSheet component:

    1. "use client" directive

    2. Imports:
       - Doc from "@/convex/_generated/dataModel"
       - Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription from "@/components/ui/sheet"
       - Separator from "@/components/ui/separator"
       - StatusDropdown from "./StatusDropdown"
       - getFloorLabel from "@/lib/constants/floors"

    3. Props interface:
       ```typescript
       interface ApplicationSheetProps {
         application: Doc<"applications"> | null;
         open: boolean;
         onOpenChange: (open: boolean) => void;
       }
       ```

    4. Create helper component for displaying field:
       ```typescript
       function Field({ label, value }: { label: string; value: string | undefined }) {
         if (!value) return null;
         return (
           <div className="space-y-1">
             <p className="text-sm font-medium text-muted-foreground">{label}</p>
             <p className="text-sm whitespace-pre-wrap">{value}</p>
           </div>
         );
       }
       ```

    5. Sheet content organized by sections:
       - Header: Initiative name as title, tagline as description
       - Status section: StatusDropdown component
       - Applicant Info section: Name, Email, LinkedIn (if present), Role, Bio
       - Proposal section: Floor, Initiative, Values, Target Community, Estimated Size
       - Roadmap section: Phase 1, Phase 2, Phase 3
       - Impact section: Benefit to FT
       - Logistics section: Existing Community, Space Needs, Start Date, Additional Notes (if present)
       - Footer: Submitted date

    6. Use Separator between sections. Use overflow-y-auto on SheetContent.

    7. Handle null application gracefully (return Sheet with empty content or null).

    Format dates with toLocaleDateString() for readable format.
    Format floor with getFloorLabel() function.
  </action>
  <verify>
    - ApplicationSheet.tsx exists and exports ApplicationSheet
    - TypeScript compiles without errors
    - All application fields are displayed
  </verify>
  <done>
    ApplicationSheet component displays all application fields organized by section with status management.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update admin page to use ApplicationsTable and ApplicationSheet</name>
  <files>src/app/admin/page.tsx</files>
  <action>
    Transform the admin page from placeholder to functional dashboard:

    1. Keep existing session verification logic at the top (defense in depth).

    2. Create a new client component for the dashboard content:
       Either inline or create src/components/admin/AdminDashboard.tsx

       Since admin page is a server component (uses cookies), the table needs to be a client component.
       Option A: Create AdminDashboard.tsx client component and import it
       Option B: Create inline "use client" wrapper

       Recommended: Create AdminDashboard.tsx for cleaner separation.

    3. AdminDashboard.tsx (new file):
       ```typescript
       "use client";

       import { useState } from "react";
       import { Doc } from "@/convex/_generated/dataModel";
       import { ApplicationsTable } from "./ApplicationsTable";
       import { ApplicationSheet } from "./ApplicationSheet";

       export function AdminDashboard() {
         const [selectedApplication, setSelectedApplication] = useState<Doc<"applications"> | null>(null);
         const [sheetOpen, setSheetOpen] = useState(false);

         const handleRowClick = (application: Doc<"applications">) => {
           setSelectedApplication(application);
           setSheetOpen(true);
         };

         return (
           <>
             <ApplicationsTable onRowClick={handleRowClick} />
             <ApplicationSheet
               application={selectedApplication}
               open={sheetOpen}
               onOpenChange={setSheetOpen}
             />
           </>
         );
       }
       ```

    4. Update src/app/admin/page.tsx:
       - Keep session verification
       - Replace placeholder content with proper dashboard layout:
         - Header with title "Admin Dashboard" and logout button
         - Main content area with AdminDashboard component
       - Use proper spacing and layout (max-w-7xl, mx-auto, p-6, etc.)

    5. Layout structure:
       ```tsx
       <main className="min-h-screen bg-background">
         <header className="border-b">
           <div className="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
             <h1 className="text-2xl font-bold">Admin Dashboard</h1>
             <form action={logout}>
               <Button type="submit" variant="outline">Logout</Button>
             </form>
           </div>
         </header>
         <div className="max-w-7xl mx-auto px-6 py-8">
           <AdminDashboard />
         </div>
       </main>
       ```
  </action>
  <verify>
    - src/components/admin/AdminDashboard.tsx exists
    - src/app/admin/page.tsx imports and uses AdminDashboard
    - TypeScript compiles: npx tsc --noEmit
    - Page still has session verification
  </verify>
  <done>
    Admin page displays applications table, clicking row opens detail sheet with status management.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes without errors
2. StatusDropdown.tsx exports StatusDropdown with useMutation
3. ApplicationSheet.tsx exports ApplicationSheet with all form sections
4. AdminDashboard.tsx exports AdminDashboard wiring table and sheet
5. Admin page imports AdminDashboard and maintains session verification
6. Full flow: navigate to /admin, see table, click row, see sheet, change status
</verification>

<success_criteria>
- Clicking table row opens ApplicationSheet with full details
- All application fields visible in organized sections
- StatusDropdown allows changing status (New, Under Review, Accepted, Rejected)
- Status change persists via Convex mutation (real-time update)
- Admin dashboard has proper header with logout button
- Session verification still protects the page
</success_criteria>

<output>
After completion, create `.planning/phases/06-admin-dashboard/06-03-SUMMARY.md`
</output>
