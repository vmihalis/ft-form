---
phase: 22-wysiwyg-form-builder
plan: 03
type: execute
wave: 2
depends_on: ["22-01"]
files_modified:
  - src/components/form-builder/AddFieldButton.tsx
  - src/components/form-builder/FieldTypePicker.tsx
autonomous: true

must_haves:
  truths:
    - "Plus button appears on hover between fields"
    - "Plus button opens popover with field type grid"
    - "Clicking a field type adds that field"
    - "All 10 field types are available in picker"
  artifacts:
    - path: "src/components/form-builder/AddFieldButton.tsx"
      provides: "Plus button for adding fields at specific position"
      contains: "PopoverTrigger"
      exports: ["AddFieldButton"]
    - path: "src/components/form-builder/FieldTypePicker.tsx"
      provides: "Grid of field types for selection"
      contains: "FIELD_TYPES"
      exports: ["FieldTypePicker"]
  key_links:
    - from: "src/components/form-builder/AddFieldButton.tsx"
      to: "src/components/form-builder/FieldTypePicker.tsx"
      via: "FieldTypePicker import"
      pattern: "FieldTypePicker"
---

<objective>
Create AddFieldButton and FieldTypePicker components for Notion/Linear-style field insertion.

Purpose: Enable adding fields at specific positions via plus button between fields, which opens a field type picker popover.

Output: Plus button component that reveals on hover and opens field type picker. All 10 field types available.
</objective>

<execution_context>
@/home/memehalis/.claude/get-shit-done/workflows/execute-plan.md
@/home/memehalis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-wysiwyg-form-builder/22-RESEARCH.md
@.planning/phases/22-wysiwyg-form-builder/22-01-SUMMARY.md

@src/types/form-schema.ts
@src/components/form-builder/FieldPreview.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FieldTypePicker component</name>
  <files>src/components/form-builder/FieldTypePicker.tsx</files>
  <action>
Create grid of field types for selection:

```typescript
// src/components/form-builder/FieldTypePicker.tsx
"use client";

import { Button } from "@/components/ui/button";
import {
  Type,
  Mail,
  Link,
  AlignLeft,
  Hash,
  Calendar,
  ChevronDown,
  Circle,
  CheckSquare,
  Upload,
} from "lucide-react";
import type { FieldType } from "@/types/form-schema";

const FIELD_TYPES: { type: FieldType; label: string; icon: React.ElementType }[] = [
  { type: "text", label: "Text", icon: Type },
  { type: "email", label: "Email", icon: Mail },
  { type: "url", label: "URL", icon: Link },
  { type: "textarea", label: "Long Text", icon: AlignLeft },
  { type: "number", label: "Number", icon: Hash },
  { type: "date", label: "Date", icon: Calendar },
  { type: "select", label: "Dropdown", icon: ChevronDown },
  { type: "radio", label: "Radio", icon: Circle },
  { type: "checkbox", label: "Checkbox", icon: CheckSquare },
  { type: "file", label: "File Upload", icon: Upload },
];

interface FieldTypePickerProps {
  onSelect: (type: FieldType) => void;
}

export function FieldTypePicker({ onSelect }: FieldTypePickerProps) {
  return (
    <div className="grid grid-cols-2 gap-1">
      {FIELD_TYPES.map(({ type, label, icon: Icon }) => (
        <Button
          key={type}
          variant="ghost"
          className="h-auto py-2 justify-start gap-2 text-sm"
          onClick={() => onSelect(type)}
        >
          <Icon className="h-4 w-4 text-muted-foreground shrink-0" />
          <span className="truncate">{label}</span>
        </Button>
      ))}
    </div>
  );
}
```

Key implementation notes:
- All 10 field types from FormSchema: text, email, url, textarea, number, date, select, radio, checkbox, file
- Icons match existing FieldPreview icons for consistency
- 2-column grid layout fits nicely in popover
- Ghost variant buttons for clickable but subtle appearance
- onSelect callback receives FieldType, parent handles insertion
  </action>
  <verify>
- `ls src/components/form-builder/FieldTypePicker.tsx` - file exists
- `grep -c 'type: "' src/components/form-builder/FieldTypePicker.tsx` - returns 10 (all field types in FIELD_TYPES array)
- `grep "FieldType" src/components/form-builder/FieldTypePicker.tsx` - uses FieldType from schema
- `npx tsc --noEmit` - no TypeScript errors
  </verify>
  <done>
FieldTypePicker component renders 2-column grid with all 10 field types, each with icon and label.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AddFieldButton component</name>
  <files>src/components/form-builder/AddFieldButton.tsx</files>
  <action>
Create plus button that appears on hover between fields:

```typescript
// src/components/form-builder/AddFieldButton.tsx
"use client";

import { useState } from "react";
import { Plus } from "lucide-react";
import { Button } from "@/components/ui/button";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "@/components/ui/popover";
import { FieldTypePicker } from "./FieldTypePicker";
import { cn } from "@/lib/utils";
import type { FieldType } from "@/types/form-schema";

interface AddFieldButtonProps {
  onAddField: (type: FieldType) => void;
}

export function AddFieldButton({ onAddField }: AddFieldButtonProps) {
  const [open, setOpen] = useState(false);

  const handleSelect = (type: FieldType) => {
    onAddField(type);
    setOpen(false);
  };

  return (
    <div className="relative h-6 group">
      {/* Horizontal line indicator on hover */}
      <div
        className={cn(
          "absolute inset-x-4 top-1/2 -translate-y-1/2 h-0.5",
          "bg-transparent group-hover:bg-primary/30 transition-colors",
          open && "bg-primary/30"
        )}
      />

      {/* Plus button - centered */}
      <Popover open={open} onOpenChange={setOpen}>
        <PopoverTrigger asChild>
          <Button
            variant="outline"
            size="icon"
            className={cn(
              "absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",
              "h-6 w-6 rounded-full",
              "opacity-0 group-hover:opacity-100 transition-opacity",
              "shadow-sm bg-background",
              open && "opacity-100"
            )}
          >
            <Plus className="h-3 w-3" />
          </Button>
        </PopoverTrigger>
        <PopoverContent className="w-56 p-2" align="center">
          <FieldTypePicker onSelect={handleSelect} />
        </PopoverContent>
      </Popover>
    </div>
  );
}
```

Key implementation notes:
- Height of 6 (24px) creates comfortable hover zone between fields
- Plus button starts with opacity-0, reveals on hover or when open
- Horizontal line indicator appears on hover (visual feedback)
- Popover centered below button via align="center"
- On select, calls onAddField and closes popover
- Parent component provides the callback that calls addFieldAtIndex
  </action>
  <verify>
- `ls src/components/form-builder/AddFieldButton.tsx` - file exists
- `grep "PopoverTrigger" src/components/form-builder/AddFieldButton.tsx` - uses Popover
- `grep "FieldTypePicker" src/components/form-builder/AddFieldButton.tsx` - renders picker
- `grep "onAddField" src/components/form-builder/AddFieldButton.tsx` - callback prop
- `npx tsc --noEmit` - no TypeScript errors
  </verify>
  <done>
AddFieldButton component renders plus button that appears on hover and opens FieldTypePicker popover.
  </done>
</task>

</tasks>

<verification>
1. `ls src/components/form-builder/AddFieldButton.tsx src/components/form-builder/FieldTypePicker.tsx` - both files exist
2. `npx tsc --noEmit` - no TypeScript errors
3. FieldTypePicker includes all 10 field types (text, email, url, textarea, number, date, select, radio, checkbox, file)
</verification>

<success_criteria>
- AddFieldButton renders with opacity-0 initially, opacity-100 on hover
- AddFieldButton shows horizontal line indicator on hover
- Clicking plus button opens Popover with FieldTypePicker
- FieldTypePicker shows all 10 field types in 2-column grid
- Clicking a field type calls onAddField callback and closes popover
- TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/22-wysiwyg-form-builder/22-03-SUMMARY.md`
</output>
