---
phase: 25-core-ai-infrastructure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/ai/system-prompt.ts
  - src/lib/ai/error-handling.ts
autonomous: true

must_haves:
  truths:
    - "System prompt includes complete Frontier Tower context"
    - "System prompt explicitly lists available and unavailable field types"
    - "All API errors are transformed to actionable user messages"
    - "Error messages never expose raw technical details to users"
  artifacts:
    - path: "src/lib/ai/system-prompt.ts"
      provides: "System prompt with FT context"
      exports: ["FORM_CREATION_SYSTEM_PROMPT"]
      contains: "Frontier Tower"
    - path: "src/lib/ai/error-handling.ts"
      provides: "Error transformation utilities"
      exports: ["transformAIError"]
  key_links:
    - from: "src/lib/ai/system-prompt.ts"
      to: "FT-CONTEXT.md"
      via: "Embedded content"
      pattern: "Floor.*Robotics.*AI.*Ethereum"
    - from: "src/lib/ai/error-handling.ts"
      to: "OpenRouter API"
      via: "Error code detection"
      pattern: "401|429|402"
---

<objective>
Create the system prompt with Frontier Tower context and error handling utilities

Purpose: The system prompt teaches the AI about Frontier Tower's floors, member types, and form patterns so it generates contextually appropriate forms. Error handling ensures users see helpful messages instead of cryptic API errors.

Output: Two files providing the AI's knowledge base and error transformation
</objective>

<execution_context>
@/Users/memehalis/.claude/get-shit-done/workflows/execute-plan.md
@/Users/memehalis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-core-ai-infrastructure/25-RESEARCH.md

# FT context to embed in system prompt
@.planning/research/FT-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create system prompt with Frontier Tower context</name>
  <files>src/lib/ai/system-prompt.ts</files>
  <action>
Create comprehensive system prompt that embeds Frontier Tower context:

1. Role definition:
   - "You are a form creation assistant for Frontier Tower (FT), a premium innovation hub in San Francisco."
   - Help admins create forms by understanding needs and generating valid form schemas

2. Available field types (ONLY these 10):
   - text: Single-line text input
   - email: Email address with validation
   - url: Website URL
   - textarea: Multi-line text
   - number: Numeric input (supports min/max validation)
   - date: Date picker
   - select: Dropdown menu (requires options array)
   - radio: Radio button group (requires options array)
   - checkbox: Checkbox (single or multiple with options)
   - file: File upload

3. NOT AVAILABLE (explicit list to prevent AI hallucination):
   - Conditional logic / show-if rules
   - Multi-column layouts
   - Rating scales or sliders
   - Signature fields
   - Rich text fields
   - Field branching
   - Phone number field type (use text with pattern)
   - Address field type (use multiple text fields)

4. Frontier Tower context (embed from FT-CONTEXT.md):
   - What is Frontier Tower (vertical village, innovation hub)
   - Floor specializations with full directory (Floors 4-13)
   - Community model (Floor Leads, member types)
   - Typical form use cases (applications, registrations, feedback)
   - Language and tone guidelines (ambitious but approachable)

5. Floor selection options (exact values for compatibility):
   ```
   floor-4: Floor 4 - Robotics & Hard Tech
   floor-5: Floor 5 - Movement Floor & Fitness Center
   floor-6: Floor 6 - Arts & Music
   floor-7: Floor 7 - Frontier Maker Space
   floor-8: Floor 8 - Neuro & Biotech
   floor-9: Floor 9 - AI & Autonomous Systems
   floor-10: Floor 10 - Frontier @ Accelerate
   floor-11: Floor 11 - Health & Longevity
   floor-12: Floor 12 - Ethereum & Decentralized Tech
   floor-13: Floor 13 - Ethereum & Decentralized Tech
   ```

6. Output format specification (JSON schema structure):
   - steps array with id, title, description, fields
   - fields with id, type, label, description, placeholder, required, validation, options
   - settings with submitButtonText, successMessage, welcomeMessage

7. Rules for form generation:
   - Field IDs must be unique, use snake_case (e.g., "first_name", "floor_selection")
   - Select/radio fields MUST have options array with both value and label
   - Use 2-4 fields per step typically
   - Validation properties depend on field type
   - Always include email field for follow-up
   - For floor-related forms, include floor dropdown with provided options

Export as: `export const FORM_CREATION_SYSTEM_PROMPT = \`...\``
  </action>
  <verify>
TypeScript compiles: `pnpm build`

The constant is exported and contains:
- All 10 field types listed
- "NOT AVAILABLE" section
- "Frontier Tower" context
- Floor selection options with exact values
  </verify>
  <done>
FORM_CREATION_SYSTEM_PROMPT is exported with complete Frontier Tower context, explicit field type lists, floor options, and form generation rules.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create error transformation utilities</name>
  <files>src/lib/ai/error-handling.ts</files>
  <action>
Create error handling utilities that transform raw errors to user-friendly messages:

1. Define return type:
   ```typescript
   interface TransformedError {
     message: string;      // Short error title
     actionable: string;   // What user can do about it
     status: number;       // HTTP status code
   }
   ```

2. Create transformAIError function that handles these cases:

   a. OpenRouter authentication (401):
      - message: "Invalid API key"
      - actionable: "Please check your OpenRouter API key and try again."
      - status: 401

   b. Rate limiting (429):
      - message: "Rate limited"
      - actionable: "Too many requests. Please wait a moment and try again."
      - status: 429

   c. Credit depletion (402):
      - message: "Insufficient credits"
      - actionable: "Your OpenRouter account needs more credits to continue."
      - status: 402

   d. Schema validation failure (check for NoObjectGeneratedError pattern):
      - message: "Could not generate valid form"
      - actionable: "The AI could not create a valid form structure. Try rephrasing your request."
      - status: 422

   e. Network/timeout errors:
      - message: "Connection error"
      - actionable: "Could not reach the AI service. Please check your connection and try again."
      - status: 503

   f. Fallback for unknown errors:
      - message: "Generation failed"
      - actionable: "Something went wrong. Please try again."
      - status: 500

3. Error detection logic:
   - Check error.message for status codes (401, 429, 402)
   - Check error.name or error.constructor.name for specific error types
   - Log original error to console for debugging (but don't expose to user)

Export: `export function transformAIError(error: unknown): TransformedError`
  </action>
  <verify>
TypeScript compiles: `pnpm build`

The function handles all documented error cases and never exposes raw error messages.
  </verify>
  <done>
transformAIError is exported and correctly maps all known API errors to actionable user messages. Unknown errors get a safe fallback message.
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` succeeds without type errors
2. System prompt includes "Frontier Tower", floor options, and all 10 field types
3. Error handling covers 401, 429, 402, validation, network, and fallback cases
</verification>

<success_criteria>
- src/lib/ai/system-prompt.ts exports FORM_CREATION_SYSTEM_PROMPT constant
- System prompt contains complete FT context (floors, member types, form patterns)
- System prompt lists all 10 available field types and "NOT AVAILABLE" features
- src/lib/ai/error-handling.ts exports transformAIError function
- All error cases return {message, actionable, status} - never raw technical errors
- TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/25-core-ai-infrastructure/25-02-SUMMARY.md`
</output>
