---
phase: 15-admin-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/admin/SubmissionsTable.tsx
  - src/components/admin/submissions-columns.tsx
  - src/components/admin/FormFilter.tsx
autonomous: true

must_haves:
  truths:
    - "Submissions table displays all dynamic form submissions"
    - "Admin can filter submissions by which form they came from"
    - "Submissions show form name, status, and submitted date"
    - "Clicking a submission row opens detail sheet (placeholder for Plan 03)"
  artifacts:
    - path: "src/components/admin/SubmissionsTable.tsx"
      provides: "Table component for dynamic submissions"
      exports: ["SubmissionsTable"]
    - path: "src/components/admin/submissions-columns.tsx"
      provides: "TanStack Table column definitions"
      exports: ["submissionsColumns"]
    - path: "src/components/admin/FormFilter.tsx"
      provides: "Filter dropdown for forms"
      exports: ["FormFilter"]
  key_links:
    - from: "src/components/admin/SubmissionsTable.tsx"
      to: "convex/submissions.ts"
      via: "useQuery(api.submissions.list)"
      pattern: "api\\.submissions\\.list"
    - from: "src/components/admin/SubmissionsTable.tsx"
      to: "src/components/admin/FormFilter.tsx"
      via: "imports FormFilter"
      pattern: "import.*FormFilter"
---

<objective>
Create submissions table with form filter for viewing dynamic form submissions.

Purpose: Enable admins to see all submissions from dynamic forms and filter by specific form. This is the parallel track to Plan 01 (tabs).

Output: SubmissionsTable component with FormFilter that uses existing Convex backend.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-admin-integration/15-RESEARCH.md

# Existing patterns to follow
@src/components/admin/ApplicationsTable.tsx
@src/components/admin/columns.tsx
@src/components/admin/FloorFilter.tsx
@convex/submissions.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SubmissionsTable Component</name>
  <files>
    src/components/admin/SubmissionsTable.tsx
    src/components/admin/submissions-columns.tsx
  </files>
  <action>
Create SubmissionsTable following the exact pattern of ApplicationsTable.

1. Create `src/components/admin/submissions-columns.tsx`:
   - Define TanStack Table columns for submissions
   - Columns: Form Name, Status, Submitted Date
   - Use same StatusBadge pattern from applications columns
   - Status values: "new", "under_review", "accepted", "rejected"
   - Status badge colors match existing pattern:
     - new: bg-blue-100 text-blue-800
     - under_review: bg-yellow-100 text-yellow-800
     - accepted: bg-green-100 text-green-800
     - rejected: bg-red-100 text-red-800

```typescript
import { ColumnDef } from "@tanstack/react-table";
import { Badge } from "@/components/ui/badge";

type SubmissionRow = {
  _id: string;
  formVersionId: string;
  status: "new" | "under_review" | "accepted" | "rejected";
  submittedAt: number;
  formName: string;
  formSlug?: string;
  version?: number;
};

const statusConfig = {
  new: { label: "New", className: "bg-blue-100 text-blue-800 border-blue-200" },
  under_review: { label: "Under Review", className: "bg-yellow-100 text-yellow-800 border-yellow-200" },
  accepted: { label: "Accepted", className: "bg-green-100 text-green-800 border-green-200" },
  rejected: { label: "Rejected", className: "bg-red-100 text-red-800 border-red-200" },
};

export const submissionsColumns: ColumnDef<SubmissionRow>[] = [
  {
    accessorKey: "formName",
    header: "Form",
    cell: ({ row }) => (
      <span className="font-medium">{row.getValue("formName")}</span>
    ),
  },
  {
    accessorKey: "status",
    header: "Status",
    cell: ({ row }) => {
      const status = row.getValue("status") as keyof typeof statusConfig;
      const config = statusConfig[status];
      return (
        <Badge variant="outline" className={config.className}>
          {config.label}
        </Badge>
      );
    },
    filterFn: (row, id, filterValue) => {
      if (!filterValue || filterValue === "all") return true;
      return row.getValue(id) === filterValue;
    },
  },
  {
    accessorKey: "submittedAt",
    header: "Submitted",
    cell: ({ row }) => {
      const date = new Date(row.getValue("submittedAt") as number);
      return date.toLocaleDateString("en-US", {
        month: "short",
        day: "numeric",
        year: "numeric",
      });
    },
  },
];
```

2. Create `src/components/admin/SubmissionsTable.tsx`:
   - Follow ApplicationsTable pattern exactly
   - Use useQuery(api.submissions.list) for data
   - Use TanStack Table with useReactTable
   - Add columnFilters state for form filter
   - Add globalFilter state for search
   - Pass onRowClick callback for opening detail sheet
   - Include TableSkeleton for loading state
   - Include empty state when no submissions

Interface:
```typescript
interface SubmissionsTableProps {
  onRowClick?: (submission: SubmissionRow) => void;
}
```

Key differences from ApplicationsTable:
- Data source: api.submissions.list
- Columns: formName, status, submittedAt
- Global filter: search by formName only
- Column filter: formName (for FormFilter integration)
  </action>
  <verify>
Create a test submission via the public form, then check the SubmissionsTable displays it correctly. Verify loading skeleton shows during data fetch.
  </verify>
  <done>
SubmissionsTable component renders submissions list with form name, status, and date columns. Loading skeleton displays during fetch. Empty state shows when no submissions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FormFilter and Integrate with Table</name>
  <files>
    src/components/admin/FormFilter.tsx
    src/components/admin/SubmissionsTable.tsx
  </files>
  <action>
1. Create `src/components/admin/FormFilter.tsx`:
   - Follow FloorFilter pattern exactly
   - Fetch forms list using useQuery(api.forms.list)
   - Show "All Forms" option plus each form by name
   - Use Select component from @/components/ui/select

```typescript
"use client";

import { useQuery } from "convex/react";
import { api } from "../../../convex/_generated/api";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";

interface FormFilterProps {
  value: string;
  onValueChange: (value: string) => void;
}

export function FormFilter({ value, onValueChange }: FormFilterProps) {
  const forms = useQuery(api.forms.list);

  return (
    <Select value={value} onValueChange={onValueChange}>
      <SelectTrigger className="w-[220px]">
        <SelectValue placeholder="Filter by form" />
      </SelectTrigger>
      <SelectContent>
        <SelectItem value="all">All Forms</SelectItem>
        {forms?.map((form) => (
          <SelectItem key={form._id} value={form.name}>
            {form.name}
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
  );
}
```

2. Update SubmissionsTable to include FormFilter:
   - Add FormFilter in filters row (like FloorFilter in ApplicationsTable)
   - Wire filter value to table column filter on "formName"
   - Add SearchInput for global filter (reuse existing component)

Filter integration:
```typescript
const handleFormFilter = (value: string) => {
  table.getColumn("formName")?.setFilterValue(value === "all" ? undefined : value);
};

// In render:
<div className="flex gap-4">
  <FormFilter
    value={(table.getColumn("formName")?.getFilterValue() as string) ?? "all"}
    onValueChange={handleFormFilter}
  />
  <SearchInput
    value={globalFilter}
    onChange={(e) => setGlobalFilter(e.target.value)}
  />
</div>
```
  </action>
  <verify>
Navigate to Submissions tab. Verify FormFilter shows all forms. Select a specific form - table should filter to only that form's submissions. Clear filter - all submissions return.
  </verify>
  <done>
FormFilter dropdown shows all available forms. Filtering by form shows only submissions from that form. Search input filters by form name. Both filters work together.
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire SubmissionsTable to AdminTabs</name>
  <files>
    src/components/admin/AdminTabs.tsx
  </files>
  <action>
Update AdminTabs (from Plan 01) to render SubmissionsTable in the Submissions tab:

1. Import SubmissionsTable component
2. Replace "Coming soon" placeholder with SubmissionsTable
3. Add state for selectedSubmission and submissionSheetOpen
4. Pass onRowClick handler to SubmissionsTable
5. For now, just log the clicked submission (Sheet comes in Plan 03)

```typescript
// In AdminTabs
const [selectedSubmission, setSelectedSubmission] = useState<SubmissionRow | null>(null);
const [submissionSheetOpen, setSubmissionSheetOpen] = useState(false);

const handleSubmissionClick = (submission: SubmissionRow) => {
  setSelectedSubmission(submission);
  setSubmissionSheetOpen(true);
  // Sheet component added in Plan 03
};

// In TabsContent for submissions:
<TabsContent value="submissions">
  <SubmissionsTable onRowClick={handleSubmissionClick} />
  {/* SubmissionSheet added in Plan 03 */}
</TabsContent>
```

Note: The SubmissionSheet component will be added in Plan 03. For now, clicking a row will set state but no sheet opens yet.
  </action>
  <verify>
Navigate to /admin?tab=submissions. Verify SubmissionsTable renders. Click a submission row - should set selected state (check React DevTools or add console.log).
  </verify>
  <done>
Submissions tab shows SubmissionsTable with form filter. Clicking row sets selectedSubmission state. Ready for Plan 03 to add SubmissionSheet.
  </done>
</task>

</tasks>

<verification>
1. Navigate to /admin?tab=submissions
2. SubmissionsTable displays with form name, status, submitted date
3. FormFilter dropdown lists all forms
4. Selecting a form filters the table
5. Search input filters by form name
6. Clicking row sets selection state (verify in React DevTools)
7. Loading skeleton shows during initial data fetch
8. Empty state shows if no submissions exist
</verification>

<success_criteria>
- SubmissionsTable displays all dynamic form submissions
- FormFilter shows all forms and filters table correctly
- Search input filters by form name
- Click handler sets selected submission
- Loading and empty states work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/15-admin-integration/15-02-SUMMARY.md`
</output>
