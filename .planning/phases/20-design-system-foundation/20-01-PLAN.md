---
phase: 20-design-system-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/theme-provider.tsx
  - src/app/layout.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "ThemeProvider wraps the application enabling theme switching"
    - "Theme preference persists in localStorage across sessions"
    - "Glass utilities display correctly on both light and dark backgrounds"
    - "CSS variables define all theme-aware glass effects"
  artifacts:
    - path: "src/components/theme-provider.tsx"
      provides: "Client component wrapping next-themes"
      exports: ["ThemeProvider"]
    - path: "src/app/layout.tsx"
      provides: "Root layout with ThemeProvider wrapper"
      contains: "ThemeProvider"
    - path: "src/app/globals.css"
      provides: "Theme-aware glass CSS variables"
      contains: "--glass-bg"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/theme-provider.tsx"
      via: "import and wrap children"
      pattern: "import.*ThemeProvider"
    - from: "src/app/globals.css"
      to: "theme class selector"
      via: "CSS custom properties in .dark"
      pattern: "\\.dark.*--glass-bg"
---

<objective>
Install next-themes and establish theme infrastructure with theme-aware glass utilities.

Purpose: Enable light/dark mode switching with localStorage persistence, and convert hardcoded glass utilities to CSS variables that work in both themes.
Output: ThemeProvider wrapper, updated layout.tsx, theme-aware CSS variables for glass effects.
</objective>

<execution_context>
@/home/memehalis/.claude/get-shit-done/workflows/execute-plan.md
@/home/memehalis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-design-system-foundation/20-RESEARCH.md

@src/app/layout.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install next-themes and create ThemeProvider</name>
  <files>package.json, src/components/theme-provider.tsx, src/app/layout.tsx</files>
  <action>
1. Install next-themes:
   ```bash
   npm install next-themes
   ```

2. Create `src/components/theme-provider.tsx` as a client component:
   ```typescript
   "use client"

   import * as React from "react"
   import { ThemeProvider as NextThemesProvider } from "next-themes"

   export function ThemeProvider({
     children,
     ...props
   }: React.ComponentProps<typeof NextThemesProvider>) {
     return <NextThemesProvider {...props}>{children}</NextThemesProvider>
   }
   ```

3. Update `src/app/layout.tsx`:
   - Remove hardcoded `className="dark"` from `<html>` element
   - Add `suppressHydrationWarning` to `<html>` element (prevents React warning about theme script)
   - Import ThemeProvider from `@/components/theme-provider`
   - Wrap the content (after BackgroundWrapper, around ConvexClientProvider) with ThemeProvider
   - Configure ThemeProvider with:
     - `attribute="class"` (applies theme as class on html)
     - `defaultTheme="dark"` (maintains current behavior during migration)
     - `enableSystem` (respects OS preference if user hasn't set preference)
     - `disableTransitionOnChange` (prevents FOUC during theme switch)
  </action>
  <verify>
1. Run `npm list next-themes` - should show version 0.4.x
2. Check `src/components/theme-provider.tsx` exists with "use client" directive
3. Check `src/app/layout.tsx` has ThemeProvider wrapper and suppressHydrationWarning
4. Run `npm run build` - should compile without errors
  </verify>
  <done>
- next-themes installed
- ThemeProvider client component exists at src/components/theme-provider.tsx
- layout.tsx wraps app with ThemeProvider (attribute="class", defaultTheme="dark", enableSystem)
- No hardcoded "dark" class on html element
- Build succeeds
  </done>
</task>

<task type="auto">
  <name>Task 2: Add theme-aware glass CSS variables</name>
  <files>src/app/globals.css</files>
  <action>
1. Add glass CSS variables to `:root` section (light mode values):
   ```css
   /* Glass tokens - light mode */
   --glass-bg: oklch(1 0 0 / 60%);
   --glass-bg-heavy: oklch(1 0 0 / 70%);
   --glass-border: oklch(0 0 0 / 8%);
   --glass-shadow: 0 8px 32px oklch(0 0 0 / 8%);
   --glass-shadow-heavy: 0 25px 50px -12px oklch(0 0 0 / 15%);
   ```

2. Add glass CSS variables to `.dark` section (dark mode values):
   ```css
   /* Glass tokens - dark mode */
   --glass-bg: oklch(0.15 0 0 / 60%);
   --glass-bg-heavy: oklch(0 0 0 / 50%);
   --glass-border: oklch(1 0 0 / 12%);
   --glass-shadow: 0 8px 32px oklch(0 0 0 / 40%);
   --glass-shadow-heavy: 0 25px 50px -12px oklch(0 0 0 / 25%);
   ```

3. Update existing `@utility glass` to use variables instead of hardcoded colors:
   ```css
   @utility glass {
     background: var(--glass-bg);
     backdrop-filter: blur(16px);
     border: 1px solid var(--glass-border);
   }
   ```

4. Update existing `@utility glass-card` to use variables:
   ```css
   @utility glass-card {
     background: var(--glass-bg-heavy);
     backdrop-filter: blur(12px);
     border: 1px solid var(--glass-border);
     box-shadow: var(--glass-shadow-heavy);
   }
   ```

5. Add accessibility fallbacks at the end of the file:
   ```css
   /* Accessibility: reduced transparency support */
   @media (prefers-reduced-transparency: reduce) {
     :root {
       --glass-bg: oklch(0.97 0 0 / 95%);
       --glass-bg-heavy: oklch(0.95 0 0 / 98%);
     }
     .dark {
       --glass-bg: oklch(0.15 0 0 / 95%);
       --glass-bg-heavy: oklch(0.12 0 0 / 98%);
     }
     .glass, .glass-card {
       backdrop-filter: none;
     }
   }

   /* Fallback for browsers without backdrop-filter */
   @supports not (backdrop-filter: blur(1px)) {
     .glass, .glass-card {
       background: var(--card);
     }
   }
   ```
  </action>
  <verify>
1. Check globals.css contains `--glass-bg` in both `:root` and `.dark` sections
2. Check `@utility glass` uses `var(--glass-bg)` not hardcoded `oklch(0 0 0 / 40%)`
3. Check `@utility glass-card` uses `var(--glass-bg-heavy)` not hardcoded value
4. Run `npm run build` - should compile without CSS errors
  </verify>
  <done>
- Glass CSS variables defined in :root (light) and .dark (dark) sections
- @utility glass uses var(--glass-bg), var(--glass-border)
- @utility glass-card uses var(--glass-bg-heavy), var(--glass-border), var(--glass-shadow-heavy)
- Accessibility fallbacks for reduced-transparency and no-backdrop-filter
- Build succeeds
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes successfully
2. `npm run dev` starts without errors
3. Visit http://localhost:3000/admin - page loads in dark mode (default)
4. Inspect `<html>` element in browser devtools - should have `class="dark"` (from next-themes script)
5. In devtools, toggle html class from "dark" to "" (empty) - glass elements should remain visible with light styling
</verification>

<success_criteria>
- next-themes package installed
- ThemeProvider wraps application in layout.tsx
- Glass utilities use CSS variables that change per theme
- Build passes, no hydration warnings in console
- Manually toggling html class between "dark" and "" shows glass elements adapt colors
</success_criteria>

<output>
After completion, create `.planning/phases/20-design-system-foundation/20-01-SUMMARY.md`
</output>
