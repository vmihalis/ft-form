---
phase: 20-design-system-foundation
plan: 02
type: execute
wave: 2
depends_on: ["20-01"]
files_modified:
  - src/components/ui/mode-toggle.tsx
  - src/app/admin/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can toggle between light and dark modes via visible button in admin header"
    - "Theme changes immediately when toggle is clicked"
    - "Toggle button shows current theme state (sun for light, moon for dark)"
  artifacts:
    - path: "src/components/ui/mode-toggle.tsx"
      provides: "Theme toggle button component"
      exports: ["ModeToggle"]
    - path: "src/app/admin/page.tsx"
      provides: "Admin page with ModeToggle in header"
      contains: "ModeToggle"
  key_links:
    - from: "src/components/ui/mode-toggle.tsx"
      to: "next-themes"
      via: "useTheme hook"
      pattern: "useTheme"
    - from: "src/app/admin/page.tsx"
      to: "src/components/ui/mode-toggle.tsx"
      via: "import and render"
      pattern: "import.*ModeToggle"
---

<objective>
Create visible theme toggle control and add it to admin header.

Purpose: Users need a way to switch between light and dark modes (DS-01). The toggle should be visible in the admin interface.
Output: ModeToggle component in admin header that switches themes on click.
</objective>

<execution_context>
@/home/memehalis/.claude/get-shit-done/workflows/execute-plan.md
@/home/memehalis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-design-system-foundation/20-RESEARCH.md
@.planning/phases/20-design-system-foundation/20-01-SUMMARY.md

@src/app/admin/page.tsx
@src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ModeToggle component</name>
  <files>src/components/ui/mode-toggle.tsx</files>
  <action>
Create `src/components/ui/mode-toggle.tsx` with the mounted-state pattern to prevent hydration mismatch:

```typescript
"use client"

import * as React from "react"
import { Moon, Sun } from "lucide-react"
import { useTheme } from "next-themes"
import { Button } from "@/components/ui/button"

export function ModeToggle() {
  const [mounted, setMounted] = React.useState(false)
  const { theme, setTheme } = useTheme()

  // Prevent hydration mismatch by waiting for mount
  React.useEffect(() => setMounted(true), [])

  // Show disabled placeholder during SSR/hydration
  if (!mounted) {
    return (
      <Button variant="ghost" size="icon" disabled className="h-9 w-9">
        <Sun className="h-5 w-5" />
        <span className="sr-only">Toggle theme</span>
      </Button>
    )
  }

  return (
    <Button
      variant="ghost"
      size="icon"
      onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
      className="h-9 w-9"
    >
      <Sun className="h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
      <Moon className="absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
      <span className="sr-only">Toggle theme</span>
    </Button>
  )
}
```

Key implementation details:
- Uses `mounted` state pattern to avoid hydration mismatch
- Shows disabled Sun icon during SSR (matches light mode default appearance)
- Sun/Moon icons animate on toggle with rotate/scale transitions
- Uses existing Button component with ghost variant
- Accessible: sr-only label for screen readers
  </action>
  <verify>
1. File exists at `src/components/ui/mode-toggle.tsx`
2. Contains "use client" directive
3. Uses `useTheme` hook from next-themes
4. Has mounted state pattern with useEffect
5. TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
- ModeToggle component exists at src/components/ui/mode-toggle.tsx
- Uses mounted state pattern for hydration safety
- Toggles between light/dark on click
- Animated sun/moon icons indicate current theme
  </done>
</task>

<task type="auto">
  <name>Task 2: Add ModeToggle to admin header</name>
  <files>src/app/admin/page.tsx</files>
  <action>
Update `src/app/admin/page.tsx` to include ModeToggle in the header:

1. Add import at top:
   ```typescript
   import { ModeToggle } from "@/components/ui/mode-toggle"
   ```

2. Update the header section to include ModeToggle next to Logout button:
   ```tsx
   <header className="border-b">
     <div className="mx-auto max-w-7xl px-6 py-4 flex items-center justify-between">
       <h1 className="text-2xl font-bold">Admin Dashboard</h1>
       <div className="flex items-center gap-2">
         <ModeToggle />
         <form action={logout}>
           <Button type="submit" variant="outline">
             Logout
           </Button>
         </form>
       </div>
     </div>
   </header>
   ```

The ModeToggle is placed before Logout for logical grouping (settings before exit).
  </action>
  <verify>
1. `src/app/admin/page.tsx` imports ModeToggle
2. Header contains `<ModeToggle />` component
3. `npm run build` succeeds
4. `npm run dev` - visit /admin, toggle button visible in header
  </verify>
  <done>
- ModeToggle imported in admin/page.tsx
- Toggle button visible in admin header next to Logout
- Build succeeds
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Theme toggle functionality with light/dark mode switching and theme-aware glass utilities</what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Visit http://localhost:3000/admin and log in
3. Locate theme toggle button in header (next to Logout)
4. Click toggle - theme should switch from dark to light
5. Verify glass elements (if any visible) change appearance in light mode
6. Click toggle again - should return to dark mode
7. Refresh the page - theme preference should persist (stay in whichever mode you left it)
8. Open browser devtools Console tab - should be no hydration warnings
  </how-to-verify>
  <resume-signal>Type "approved" if toggle works and theme persists, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. ModeToggle component exists and exports correctly
3. Admin page header shows theme toggle button
4. Clicking toggle switches between light and dark modes
5. Theme persists after page refresh
6. No React hydration warnings in console
</verification>

<success_criteria>
- Visible theme toggle button in admin header (DS-01)
- Click toggles between light and dark modes immediately
- Theme preference persists across page refresh (DS-02)
- Glass elements (if any) adapt to theme
- No console errors or hydration warnings
</success_criteria>

<output>
After completion, create `.planning/phases/20-design-system-foundation/20-02-SUMMARY.md`
</output>
