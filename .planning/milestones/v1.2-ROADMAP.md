# Milestone v1.2: Dynamic Form Builder

**Status:** SHIPPED 2026-01-29
**Phases:** 11-15
**Total Plans:** 15

## Overview

Enable admins to create and customize application forms with full control over fields, types, and structure. Multiple forms with unique URLs, form versioning for data integrity, and rich field types including file uploads.

## Phases

### Phase 11: Schema Foundation

**Goal**: Forms and submissions can be stored with immutable version snapshots that preserve structure at publish time
**Depends on**: Nothing (first phase of v1.2)
**Plans**: 2 plans

Plans:
- [x] 11-01: TypeScript types and Convex schema for dynamic forms
- [x] 11-02: Form and submission mutations/queries with versioning

**Details:**
- Forms table with unique slug for URL routing
- FormVersions table for immutable snapshots
- Submissions table with formVersionId reference
- JSON string storage for nested schemas (avoids Convex 16-level limit)
- Reserved slugs list for route conflict prevention

### Phase 12: File Upload Infrastructure

**Goal**: Users can upload files in dynamic forms with immediate persistence to Convex storage
**Depends on**: Phase 11 (requires schema for file storage references)
**Plans**: 2 plans

Plans:
- [x] 12-01: Convex storage mutations, queries, and orphan cleanup cron
- [x] 12-02: useFileUpload hook and FileField component with drag-and-drop

**Details:**
- Convex storage integration with generateUploadUrl/getFileUrl
- Orphan file cleanup cron (24-hour grace, 3 AM UTC)
- XMLHttpRequest for progress tracking (fetch lacks onprogress)
- react-dropzone for drag-and-drop upload UX
- Default 50MB max with configurable override

### Phase 13: Dynamic Form Renderer

**Goal**: Dynamic forms render at unique URLs with Typeform-style UX and validate based on field configuration
**Depends on**: Phase 11 (requires form schema), Phase 12 (requires file upload for complete field support)
**Plans**: 3 plans

Plans:
- [x] 13-01: Dynamic route, Zod schema generation, and Zustand store
- [x] 13-02: Field renderer components for all field types
- [x] 13-03: Form container, step components, navigation, and review

**Details:**
- Dynamic route at /apply/[slug]
- Zod v4 schema generation from form config
- 8 field types: text, textarea, email, dropdown, number, date, checkbox, file
- Typeform-style step flow with Welcome->Content->Review->Confirmation
- localStorage draft persistence with version locking
- Per-step validation using react-hook-form trigger

### Phase 14: Form Builder UI

**Goal**: Admins can create and configure forms through drag-and-drop interface with real-time preview
**Depends on**: Phase 11 (requires schema), Phase 13 (preview uses renderer)
**Plans**: 5 plans

Plans:
- [x] 14-01: Install dnd-kit, create Zustand store, admin forms list page
- [x] 14-02: New form page, form builder shell with three-panel layout
- [x] 14-03: Field palette and form canvas with dnd-kit sortable
- [x] 14-04: Property panel, options editor, validation settings
- [x] 14-05: Preview panel, form status actions, publish/archive

**Details:**
- Three-panel layout (field palette, canvas, property panel)
- dnd-kit for drag-and-drop reordering
- Debounced autosave (500ms metadata, 300ms properties)
- Mobile/desktop preview modes with device frame
- Publish validation (labels, options required)
- Form lifecycle: draft → published → archived

### Phase 15: Admin Integration

**Goal**: Admins can manage forms and view dynamic submissions with schema-aware rendering
**Depends on**: Phase 13 (requires renderer for submission display), Phase 14 (requires forms to exist)
**Plans**: 3 plans

Plans:
- [x] 15-01: Tab navigation, Forms tab, form duplication
- [x] 15-02: SubmissionsTable with FormFilter
- [x] 15-03: SubmissionSheet with DynamicEditableField and EditHistory

**Details:**
- Admin tabs with URL query param persistence
- Form duplication with unique slug collision handling
- Submissions filtered by form name
- Schema-driven submission rendering (not hardcoded)
- Edit history with stored fieldLabel (immune to schema changes)

---

## Milestone Summary

**Key Decisions:**

- JSON string storage for form schemas (avoids Convex 16-level nesting limit)
- Immutable form versions for data integrity
- Submissions reference formVersionId, not formId
- Immediate file persistence (upload on select, not form submit)
- XMLHttpRequest over fetch for upload progress tracking
- dnd-kit for form builder drag-and-drop
- Zod v4 for dynamic validation schema generation
- Schema-driven admin panel for submission rendering

**Issues Resolved:**

- Draft reset on form version change (version locking)
- File URL expiration (immediate persistence pattern)
- Convex nested object limits (JSON string storage)
- Preview of incomplete forms (field filtering)
- Edit history label stability (stored at edit time)

**Issues Deferred:**

- Conditional logic/branching (deferred to v1.3)
- Form analytics (deferred to v1.3)
- Multi-column layouts (deferred to v1.3)

**Technical Debt Incurred:**

- 3 intentional orphaned exports for future utilities:
  - storage.deleteFile (future cleanup utility)
  - storage.getFileMetadata (future metadata feature)
  - forms.listVersions (future version history UI)

---

_For current project status, see .planning/PROJECT.md_
